!function(e,o){"function"==typeof define&&define.amd?define([],o(e)):"object"==typeof exports?module.exports=o(e):e.simplegmaps=o(e)}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";function i(n){var o;!1!==g.jsonsource&&((o=new XMLHttpRequest).open("GET",g.jsonsource,!0),o.onload=function(){var e,t;200<=o.status&&o.status<400?(e=function(e){try{var o=JSON.parse(e);if(o&&typeof o==="object"&&o!==null)return o}catch(e){}return console.warn("Error parsing JSON file"),false}(o.response),t=e.length,e.forEach(function(o){r(o,function(e){!1===e?(q("fetchPosition response: "+e),t--):(q("fetchPosition response: OK: "+e),o.position=e,s(o.iconpath,o.iconpath2x,function(e){o.icon=e,A.markers.push(o),q(A.markers.length+":"+t),A.markers.length===t&&n()}))})}),N("onJSONLoadSuccess")):g.debug&&(N("onJSONLoadFail"),console.log("An error occured when trying to load data from "+g.datasource))},o.onerror=function(){g.debug&&(N("onJSONConnectionFail"),console.log("A connection error occured when trying to access "+g.datasource))},o.send())}function r(t,n){P(t.latlng)?n(E(t.latlng)):P(t.address)&&setTimeout(W(t,function(e,o){q("status: "+e),q("response: "+o),e===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(console.warn("google.maps.GeocoderStatus.OVER_QUERY_LIMIT"),q("-- google.maps.GeocoderStatus.OVER_QUERY_LIMIT"),q("-- Unable to geolocate address. Removing marker."),n(!1)):e===google.maps.GeocoderStatus.OK?n(o):(t.latlng=null,q(e),q("No address or longitude/latitude located from address. Removing marker."),n(!1))}),g.geolocateDelay)}function a(){q("-- placeMarkers --"),u(A.markers,function(e,o){q(e);var t={},n=new google.maps.Marker({title:e.title,center:e.center});O.push(n),n=function(o,t){if(t.infoWindowContent)o.addListener("click",function(){if(g.markerBounce===true)b(o);if(g.multipleInfoWindows===false)if(v.length>0)D();var e=new google.maps.InfoWindow({content:t.infoWindowContent});e.open(C,o);v.push(e)});else if(t.CustominfoWindowContent){var n=t.CustominfoWindowContent;google.maps.event.addListener(o,"click",function(){if(g.markerBounce===true)b(o);var e=document.querySelector("#simplegmaps-c-iw");if(e!==null)e.parentNode.removeChild(e);p.insertAdjacentHTML("afterend",'<div id="simplegmaps-c-iw"></div>');document.querySelector("#simplegmaps-c-iw").innerHTML=n;document.querySelector("#simplegmaps-c-iw .close").addEventListener("click",function(e){e.preventDefault();var o=document.querySelector("#simplegmaps-c-iw");if(o!==null)o.parentNode.removeChild(o)})})}else o.addListener("click",function(){if(g.markerBounce===true)b(o);if(g.iconSwap.enabled===true)B(o)});return o}(n,e),t.position=e.position,t.icon=e.icon,n.setOptions(t),!1===g.cluster&&n.setMap(C),q(n.title)}),q("--- Cluster: "+g.cluster),!0===g.cluster&&new MarkerClusterer(C,O,{imagePath:g.ClusterImagePathPrefix});var e=new google.maps.LatLngBounds;if(0<O.length)if(!0===g.ZoomToFitBounds){q("ZoomToFitBounds");for(var o=new google.maps.LatLngBounds,t=0;t<O.length;++t)o.extend(O[t].getPosition());if(o.getNorthEast().equals(o.getSouthWest())){var n=new google.maps.LatLng(o.getNorthEast().lat()+.002,o.getNorthEast().lng()+.002);var i=new google.maps.LatLng(o.getNorthEast().lat()-.002,o.getNorthEast().lng()-.002);o.extend(n);o.extend(i)}try{C.fitBounds(o);C.setCenter(o.getCenter());N("onZoomToFitBounds")}catch(e){q("zoomToFitBounds failed")}}else{q("NO - ZoomToFitBounds");n=O.filter(function(e){return!0===e.center||"true"===e.center});P(n)?(q("centeredmarker:",n),C.setCenter(n[0].getPosition())):C.setCenter(O[0].getPosition())}else g.MapOptions.center||C.setCenter(e.getCenter());g.GeoLocation?(q("geolocation"),l()):q("no geolocation")}function s(o,t,n){var i=new Image;null===o&&null===t||""===o&&""===t?n(null):1.5<window.devicePixelRatio?null!==typeof t&&""!==t?(i.onload=function(){var e={url:t,size:new google.maps.Size(i.naturalWidth/2,i.naturalHeight/2),scaledSize:new google.maps.Size(i.naturalWidth/2,i.naturalHeight/2),origin:new google.maps.Point(0,0)};n(e)},i.src=t):null!==typeof o&&""!==o?(i.onload=function(){var e={url:o,size:new google.maps.Size(i.naturalWidth,i.naturalHeight)};n(e)},i.src=o):n(null):null!==typeof o&&""!==o?(i.onload=function(){var e={url:o,size:new google.maps.Size(i.naturalWidth,i.naturalHeight)};n(e)},i.src=o):n(null)}function l(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){e=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);C.setCenter(e)},function(){R(!0)}):R(!1)}function c(t,n){var i={};return u(t,function(e,o){i[o]=t[o]}),u(n,function(e,o){i[o]=n[o]}),i}function u(e,o,t){if("[object Object]"===Object.prototype.toString.call(e))for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.call(t,e[n],n,e);else for(var i=0,r=e.length;i<r;i++)o.call(t,e[i],i,e)}function o(e,o){e=document.querySelector(e),T=new google.maps.places.Autocomplete(e,g.autoCompleteOptions),P(o)?T.addListener("place_changed",function(){document.querySelector(o).click()}):T.addListener("place_changed",t)}function t(){var e=T.getPlace();e.geometry&&(g.AutoCompleteOptions.moveMap&&C.panTo(e.geometry.location),g.AutoCompleteOptions.setMarker&&new google.maps.Marker({map:C,position:e.geometry.location}),N("onPlaceChanged"))}function n(e){L.geocode({address:e},function(e,o){o===google.maps.GeocoderStatus.OK?(C.setCenter(e[0].geometry.location),new google.maps.Marker({map:C,position:e[0].geometry.location}),N("onSearchComplete")):(q(o),N("onSearchFail"))})}var g,p,d,m,f={},h=!!document.querySelector&&!!e.addEventListener,v=[],S=!1,w={Driving:google.maps.TravelMode.DRIVING,Bicycling:google.maps.TravelMode.BICYCLING,Transit:google.maps.TravelMode.TRANSIT,Walking:google.maps.TravelMode.WALKING},e={Metric:google.maps.UnitSystem.METRIC,Imperial:google.maps.UnitSystem.IMPERIAL},y={travelMode:w.Driving,unitSystem:e.Metric},M=new google.maps.DirectionsRenderer({draggable:!0}),L=null,C=null,k=null,A={markers:[]},O=[],T=!1,I={debug:!1,multipleInfoWindows:!1,cluster:!1,ClusterImagePathPrefix:"img/markercluster/m",geolocateLimit:10,geolocateDelay:100,GeoLocation:!1,ZoomToFitBounds:!0,jsonsource:!1,AutoComplete:!1,AutoCompleteOptions:{types:["geocode"],componentRestrictions:{country:"se"},moveMap:!1,setMarker:!1},MapOptions:{draggable:!0,zoom:7,center:"55.604981,13.003822",scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},iOSAppleMapLink:"http://maps.apple.com/",iOSGoogleMapLink:"comgooglemaps://",AndroidMapLink:"https://maps.google.se/maps",WP7MapLink:"maps:",DesktopMapLink:"http://www.google.com/maps",onInit:function(){},onDestroy:function(){},onDrawMap:function(){},onSearchInit:function(){},onSearchComplete:function(){},onSearchFail:function(){},onZoomToFitBounds:function(){},onPlaceChanged:function(){},onDirectionsInit:function(){},onRouteComplete:function(){},onRouteError:function(){},onJSONConnectionFail:function(){},onJSONLoadFail:function(){},onJSONLoadSuccess:function(){}},D=function(){for(var e=0;e<v.length;e++)v[e].close()},b=function(e){void 0===e.getAnimation()||null===e.getAnimation()?(u(O,function(e,o){e.setAnimation(null)}),e.setAnimation(google.maps.Animation.BOUNCE)):e.setAnimation(null)},B=function(e){u(O,function(e,o){e.setIcon(null)}),e.setIcon(g.iconSwap.activeIcon)},W=function(e,t){P(e.latlng)?t(E(e.latlng)):P(e.address)&&L.geocode({address:e.address},function(e,o){o===google.maps.GeocoderStatus.OK?t(o,e[0].geometry.location):(google.maps.GeocoderStatus.OVER_QUERY_LIMIT,t(o,!1))})},E=function(e){var o;return"string"==typeof e?(o=e.split(/,\s*/),new google.maps.LatLng(parseFloat(o[0]),parseFloat(o[1]))):e},P=function(e){return null!=e&&""!==e&&0<e.length},R=function(e){q(e?"SimpleGMaps: The Geolocation service failed.":"SimpleGMaps: Your browser doesn't support geolocation.")},N=function(e){void 0!==g[e]&&g[e].call(p)},q=function(e,o,t){t=void 0!==t?t:"log",g.debug&&window.console&&(null!=o&&0<o.length?console[t](e,o):console[t](e))};return f.destroy=function(){g&&(N("onDestroy"),k=C=g=null,A={markers:[]},O=[])},f.init=function(e){var t,o,n;h&&(f.destroy(),g=c(I,e||{}),q(g),p=document.querySelector(g.container),g.MapOptions.center&&(g.MapOptions.center=E(g.MapOptions.center)),g.MapOptions.zoom||(g.MapOptions.zoom=4),p.hasAttribute("data-json")&&(g.jsonsource=p.getAttribute("data-json")),L=new google.maps.Geocoder,k=p.cloneNode(!0),(C=new google.maps.Map(p,g.MapOptions)).addListener("idle",function(){N("onDrawMap")}),q("init"),!1===g.jsonsource?(q("getMapMarkersFromMarkup"),t=function(e){q("markers done"),a()},e=k.querySelectorAll(".map-marker"),o=Array.prototype.slice.call(e,0),n=e.length,q(e),0===e.length&&t(),o.forEach(function(e){var o={};o.title=e.getAttribute("data-title"),e.querySelector(".map-infowindow")?(o.infoWindowContent=e.querySelector("div.map-infowindow").parentElement.innerHTML,o.CustominfoWindowContent=null):e.querySelector(".map-custom-infowindow")&&(o.CustominfoWindowContent=e.querySelector(".map-custom-infowindow").parentElement.innerHTML,o.infoWindowContent=null),e.hasAttribute("data-center")?o.center=!0:o.center=!1,e.hasAttribute("data-icon")?o.iconpath=e.getAttribute("data-icon"):o.iconpath=null,e.hasAttribute("data-icon2x")?o.iconpath2x=e.getAttribute("data-icon2x"):o.iconpath2x=null,e.hasAttribute("data-latlng")?o.latlng=e.getAttribute("data-latlng"):o.latlng=null,e.hasAttribute("data-address")?o.address=e.getAttribute("data-address"):o.address=null,null===o.address&&null===o.latlng?(q("No address or longitude/latitude found in markup. Removing marker."),n--):r(o,function(e){!1===e?(q("fetchPosition response: "+e),n--):(q("fetchPosition response: OK: "+e),o.position=e,s(o.iconpath,o.iconpath2x,function(e){o.icon=e,A.markers.push(o),q(A.markers.length+":"+n),A.markers.length===n&&t()}))})})):(q("getMapMarkersFromJSON"),i(function(e){a()})),N("onInit"))},f.Markers={get:function(){return O}},f.Map={get:function(){return C}},f.getMarkerAddress=function(e,o){var t;t=function(e){o(e)},q(e=e),L.geocode({latLng:e.getPosition()},function(e){e&&0<e.length?t(e[0].formatted_address):t(null)})},f.Center=function(){var e=C.getCenter();google.maps.event.trigger(C,"resize"),C.setCenter(e)},f.Search={default:{input:"",eventButton:"",AutoComplete:!1},init:function(e){f.Search.options=c(f.Search.default,e||{}),f.Search.options.AutoComplete&&o(f.Search.options.input),document.querySelector(f.Search.options.eventButton).addEventListener("click",function(e){e.preventDefault(),n(document.querySelector(f.Search.options.input).value)}),document.querySelector(f.Search.options.input).addEventListener("keypress",function(e){13===e.keyCode&&n(document.querySelector(f.Search.options.input).value)}),N("onSearchInit")},initAutoComplete:function(e){o(e.input)},search:function(e){n(e)}},f.Directions={TravelModes:{get:function(){return w}},default:{AutoComplete:!1,TravelMode:y.TravelMode,UnitSystem:y.UnitSystem,originInput:"",destination:"",eventButton:""},init:function(e){f.Directions.options=c(f.Directions.default,e||{}),y.TravelMode=f.Directions.options.TravelMode,y.UnitSystem=f.Directions.options.UnitSystem,document.querySelector(f.Directions.options.eventButton).addEventListener("click",function(e){f.Directions.route({origin:document.querySelector(f.Directions.options.originInput).value,destination:f.Directions.options.destination})}),f.Directions.options.AutoComplete&&o(f.Directions.options.originInput,f.Directions.options.eventButton),N("onDirectionsInit")},initAutoComplete:function(e){g.AutoComplete=!0,o(e.originInput,e.eventButton)},travelMode:{get:function(){return y.TravelMode},set:function(e){y.TravelMode=e}},unitSystem:{get:function(){return y.UnitSystem},set:function(e){y.UnitSystem=e}},route:function(e){y=c(y,e||{});e=new google.maps.DirectionsService;q(y),M.setMap(C),g.routeDescriptionContainer&&M.setPanel(document.querySelector(g.routeDescriptionContainer)),e.route(y,function(e,o){o===google.maps.DirectionsStatus.OK?(M.setDirections(e),N("onRouteComplete")):(q(o),N("onRouteError"))})}},f.TrafficLayer={toggle:function(){m&&null!==m.map?m.setMap(null):(m=new google.maps.TrafficLayer).setMap(C)}},f.TransitLayer={toggle:function(){S&&null!==S.map?S.setMap(null):(S=new google.maps.TransitLayer).setMap(C)}},f.BicycleLayer={toggle:function(){d&&null!==d.map?d.setMap(null):(d=new google.maps.BicyclingLayer).setMap(C)}},f.GeoLocation={set:function(){l()}},f.getURL={Android:function(e){return g.AndroidMapLink+"?q="+e},ios:function(e){return g.iOSAppleMapLink+"?q="+e},WindowsPhone:function(e){return g.WP7MapLink+e},Desktop:function(e){return g.DesktopMapLink+"?q="+e},Native:function(e){return-1<navigator.userAgent.toLowerCase().indexOf("android")?f.getURL.Android(e):navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)?f.getURL.ios(e):navigator.userAgent.match(/Windows Phone/i)?f.getURL.WindowsPhone(e):f.getURL.Desktop(e)}},f});