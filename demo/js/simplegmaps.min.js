/*! simplegmaps - v2.4.0 - 2018-10-10
* https://github.com/SubZane/simplegmaps
* Copyright (c) 2018 Andreas Norman; Licensed MIT */

!function(e,o){"function"==typeof define&&define.amd?define([],o(e)):"object"==typeof exports?module.exports=o(e):e.simplegmaps=o(e)}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";var r,a,o,t,s={},l=!!document.querySelector&&!!e.addEventListener,i=[],n=!1,c={Driving:google.maps.TravelMode.DRIVING,Bicycling:google.maps.TravelMode.BICYCLING,Transit:google.maps.TravelMode.TRANSIT,Walking:google.maps.TravelMode.WALKING},u={Metric:google.maps.UnitSystem.METRIC,Imperial:google.maps.UnitSystem.IMPERIAL},g={travelMode:c.Driving,unitSystem:u.Metric},p=new google.maps.DirectionsRenderer({draggable:!0}),d=null,m=null,f=null,h={markers:[]},v=[],S=!1,w={debug:!1,multipleInfoWindows:!1,cluster:!1,ClusterImagePathPrefix:"img/markercluster/m",geolocateLimit:10,geolocateDelay:100,GeoLocation:!1,ZoomToFitBounds:!0,jsonsource:!1,AutoComplete:!1,AutoCompleteOptions:{types:["geocode"],componentRestrictions:{country:"se"},moveMap:!1,setMarker:!1},MapOptions:{draggable:!0,zoom:7,center:"55.604981,13.003822",scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},iOSAppleMapLink:"http://maps.apple.com/",iOSGoogleMapLink:"comgooglemaps://",AndroidMapLink:"https://maps.google.se/maps",WP7MapLink:"maps:",DesktopMapLink:"http://www.google.com/maps",onInit:function(){},onDestroy:function(){},onDrawMap:function(){},onSearchInit:function(){},onSearchComplete:function(){},onSearchFail:function(){},onZoomToFitBounds:function(){},onPlaceChanged:function(){},onDirectionsInit:function(){},onRouteComplete:function(){},onRouteError:function(){},onJSONConnectionFail:function(){},onJSONLoadFail:function(){},onJSONLoadSuccess:function(){}},y=function(e){try{var o=JSON.parse(e);if(o&&"object"==typeof o&&null!==o)return o}catch(e){}return console.warn("Error parsing JSON file"),!1},M=function(t,n){D(t.latlng)?n(T(t.latlng)):D(t.address)&&setTimeout(k(t,function(e,o){q("status: "+e),q("response: "+o),e===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(console.warn("google.maps.GeocoderStatus.OVER_QUERY_LIMIT"),q("-- google.maps.GeocoderStatus.OVER_QUERY_LIMIT"),q("-- Unable to geolocate address. Removing marker."),n(!1)):e===google.maps.GeocoderStatus.OK?n(o):(t.latlng=null,q(e),q("No address or longitude/latitude located from address. Removing marker."),n(!1))}),r.geolocateDelay)},L=function(){q("-- placeMarkers --"),R(h.markers,function(e,o){q(e);var t={},n=new google.maps.Marker({title:e.title,center:e.center});v.push(n),n=C(n,e),t.position=e.position,t.icon=e.icon,n.setOptions(t),!1===r.cluster&&n.setMap(m),q(n.title)}),q("--- Cluster: "+r.cluster),!0===r.cluster&&new MarkerClusterer(m,v,{imagePath:r.ClusterImagePathPrefix});var e=new google.maps.LatLngBounds;if(0<v.length)if(!0===r.ZoomToFitBounds)q("ZoomToFitBounds"),O();else{q("NO - ZoomToFitBounds");var o=v.filter(function(e){return!0===e.center||"true"===e.center});D(o)?(q("centeredmarker:",o),m.setCenter(o[0].getPosition())):m.setCenter(v[0].getPosition())}else r.MapOptions.center||m.setCenter(e.getCenter());r.GeoLocation?(q("geolocation"),I(m)):q("no geolocation")},C=function(o,t){if(t.infoWindowContent)o.addListener("click",function(){!1===r.multipleInfoWindows&&0<i.length&&function(){for(var e=0;e<i.length;e++)i[e].close()}();var e=new google.maps.InfoWindow({content:t.infoWindowContent});e.open(m,o),i.push(e)});else if(t.CustominfoWindowContent){var n=t.CustominfoWindowContent;google.maps.event.addListener(o,"click",function(){var e=document.querySelector("#simplegmaps-c-iw");null!==e&&e.parentNode.removeChild(e),a.insertAdjacentHTML("afterend",'<div id="simplegmaps-c-iw"></div>'),document.querySelector("#simplegmaps-c-iw").innerHTML=n,document.querySelector("#simplegmaps-c-iw .close").addEventListener("click",function(e){e.preventDefault();var o=document.querySelector("#simplegmaps-c-iw");null!==o&&o.parentNode.removeChild(o)})})}return o},k=function(e,t){D(e.latlng)?t(T(e.latlng)):D(e.address)&&d.geocode({address:e.address},function(e,o){o===google.maps.GeocoderStatus.OK?t(o,e[0].geometry.location):(google.maps.GeocoderStatus.OVER_QUERY_LIMIT,t(o,!1))})},A=function(o,t,n){var i=new Image;null===o&&null===t||""===o&&""===t?n(null):1.5<window.devicePixelRatio?null!==typeof t&&""!==t?(i.onload=function(){var e={url:t,size:new google.maps.Size(i.naturalWidth/2,i.naturalHeight/2),scaledSize:new google.maps.Size(i.naturalWidth/2,i.naturalHeight/2),origin:new google.maps.Point(0,0)};n(e)},i.src=t):null!==typeof o&&""!==o?(i.onload=function(){var e={url:o,size:new google.maps.Size(i.naturalWidth,i.naturalHeight)};n(e)},i.src=o):n(null):null!==typeof o&&""!==o?(i.onload=function(){var e={url:o,size:new google.maps.Size(i.naturalWidth,i.naturalHeight)};n(e)},i.src=o):n(null)},O=function(){for(var e=new google.maps.LatLngBounds,o=0;o<v.length;++o)e.extend(v[o].getPosition());if(e.getNorthEast().equals(e.getSouthWest())){var t=new google.maps.LatLng(e.getNorthEast().lat()+.002,e.getNorthEast().lng()+.002),n=new google.maps.LatLng(e.getNorthEast().lat()-.002,e.getNorthEast().lng()-.002);e.extend(t),e.extend(n)}try{m.fitBounds(e),m.setCenter(e.getCenter()),b("onZoomToFitBounds")}catch(e){q("zoomToFitBounds failed")}},T=function(e){var o;if("string"==typeof e){var t=e.split(/,\s*/);o=new google.maps.LatLng(parseFloat(t[0]),parseFloat(t[1]))}else o=e;return o},D=function(e){return null!=e&&""!==e&&0<e.length},I=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);m.setCenter(o)},function(){P(!0)}):P(!1)},P=function(e){q(e?"SimpleGMaps: The Geolocation service failed.":"SimpleGMaps: Your browser doesn't support geolocation.")},b=function(e){void 0!==r[e]&&r[e].call(a)},E=function(t,n){var i={};return R(t,function(e,o){i[o]=t[o]}),R(n,function(e,o){i[o]=n[o]}),i},R=function(e,o,t){if("[object Object]"===Object.prototype.toString.call(e))for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.call(t,e[n],n,e);else for(var i=0,r=e.length;i<r;i++)o.call(t,e[i],i,e)},q=function(e,o,t){t=void 0!==t?t:"log",r.debug&&window.console&&(null!=o&&0<o.length?console[t](e,o):console[t](e))},N=function(e,o){var t=document.querySelector(e);S=new google.maps.places.Autocomplete(t,r.autoCompleteOptions),D(o)?S.addListener("place_changed",function(){document.querySelector(o).click()}):S.addListener("place_changed",W)},W=function(){var e=S.getPlace();e.geometry&&(r.AutoCompleteOptions.moveMap&&m.panTo(e.geometry.location),r.AutoCompleteOptions.setMarker&&new google.maps.Marker({map:m,position:e.geometry.location}),b("onPlaceChanged"))},B=function(e){d.geocode({address:e},function(e,o){o===google.maps.GeocoderStatus.OK?(m.setCenter(e[0].geometry.location),new google.maps.Marker({map:m,position:e[0].geometry.location}),b("onSearchComplete")):(q(o),b("onSearchFail"))})};return s.destroy=function(){r&&(b("onDestroy"),f=m=r=null,h={markers:[]},v=[])},s.init=function(e){var t,o,n,i;l&&(s.destroy(),r=E(w,e||{}),q(r),a=document.querySelector(r.container),r.MapOptions.center&&(r.MapOptions.center=T(r.MapOptions.center)),r.MapOptions.zoom||(r.MapOptions.zoom=4),a.hasAttribute("data-json")&&(r.jsonsource=a.getAttribute("data-json")),d=new google.maps.Geocoder,f=a.cloneNode(!0),(m=new google.maps.Map(a,r.MapOptions)).addListener("idle",function(){b("onDrawMap")}),q("init"),!1===r.jsonsource?(q("getMapMarkersFromMarkup"),t=function(e){q("markers done"),L()},o=f.querySelectorAll(".map-marker"),n=Array.prototype.slice.call(o,0),i=o.length,q(o),0===o.length&&t(),n.forEach(function(e){var o={};if(o.title=e.getAttribute("data-title"),e.querySelector(".map-infowindow")?(o.infoWindowContent=e.querySelector("div.map-infowindow").parentElement.innerHTML,o.CustominfoWindowContent=null):e.querySelector(".map-custom-infowindow")&&(o.CustominfoWindowContent=e.querySelector(".map-custom-infowindow").parentElement.innerHTML,o.infoWindowContent=null),e.hasAttribute("data-center")?o.center=!0:o.center=!1,e.hasAttribute("data-icon")?o.iconpath=e.getAttribute("data-icon"):o.iconpath=null,e.hasAttribute("data-icon2x")?o.iconpath2x=e.getAttribute("data-icon2x"):o.iconpath2x=null,e.hasAttribute("data-latlng")?o.latlng=e.getAttribute("data-latlng"):o.latlng=null,e.hasAttribute("data-address")?o.address=e.getAttribute("data-address"):o.address=null,null===o.address&&null===o.latlng)return q("No address or longitude/latitude found in markup. Removing marker."),void i--;M(o,function(e){if(!1===e)return q("fetchPosition response: "+e),void i--;q("fetchPosition response: OK: "+e),o.position=e,A(o.iconpath,o.iconpath2x,function(e){o.icon=e,h.markers.push(o),q(h.markers.length+":"+i),h.markers.length===i&&t()})})})):(q("getMapMarkersFromJSON"),function(n){if(!1===r.jsonsource)return;var o=new XMLHttpRequest;o.open("GET",r.jsonsource,!0),o.onload=function(){if(200<=o.status&&o.status<400){var e=y(o.response),t=e.length;e.forEach(function(o){M(o,function(e){if(!1===e)return q("fetchPosition response: "+e),void t--;q("fetchPosition response: OK: "+e),o.position=e,A(o.iconpath,o.iconpath2x,function(e){o.icon=e,h.markers.push(o),q(h.markers.length+":"+t),h.markers.length===t&&n()})})}),b("onJSONLoadSuccess")}else r.debug&&(b("onJSONLoadFail"),console.log("An error occured when trying to load data from "+r.datasource))},o.onerror=function(){r.debug&&(b("onJSONConnectionFail"),console.log("A connection error occured when trying to access "+r.datasource))},o.send()}(function(e){L()})),b("onInit"))},s.Markers={get:function(){return v}},s.Map={get:function(){return m}},s.getMarkerAddress=function(e,o){var t,n;n=function(e){o(e)},q(t=e),d.geocode({latLng:t.getPosition()},function(e){e&&0<e.length?n(e[0].formatted_address):n(null)})},s.Center=function(){var e=m.getCenter();google.maps.event.trigger(m,"resize"),m.setCenter(e)},s.Search={default:{input:"",eventButton:"",AutoComplete:!1},init:function(e){s.Search.options=E(s.Search.default,e||{}),s.Search.options.AutoComplete&&N(s.Search.options.input),document.querySelector(s.Search.options.eventButton).addEventListener("click",function(e){e.preventDefault(),B(document.querySelector(s.Search.options.input).value)}),document.querySelector(s.Search.options.input).addEventListener("keypress",function(e){13===e.keyCode&&B(document.querySelector(s.Search.options.input).value)}),b("onSearchInit")},initAutoComplete:function(e){N(e.input)},search:function(e){B(e)}},s.Directions={TravelModes:{get:function(){return c}},default:{AutoComplete:!1,TravelMode:g.TravelMode,UnitSystem:g.UnitSystem,originInput:"",destination:"",eventButton:""},init:function(e){s.Directions.options=E(s.Directions.default,e||{}),g.TravelMode=s.Directions.options.TravelMode,g.UnitSystem=s.Directions.options.UnitSystem,document.querySelector(s.Directions.options.eventButton).addEventListener("click",function(e){s.Directions.route({origin:document.querySelector(s.Directions.options.originInput).value,destination:s.Directions.options.destination})}),s.Directions.options.AutoComplete&&N(s.Directions.options.originInput,s.Directions.options.eventButton),b("onDirectionsInit")},initAutoComplete:function(e){r.AutoComplete=!0,N(e.originInput,e.eventButton)},travelMode:{get:function(){return g.TravelMode},set:function(e){g.TravelMode=e}},unitSystem:{get:function(){return g.UnitSystem},set:function(e){g.UnitSystem=e}},route:function(e){g=E(g,e||{});var o=new google.maps.DirectionsService;q(g),p.setMap(m),r.routeDescriptionContainer&&p.setPanel(document.querySelector(r.routeDescriptionContainer)),o.route(g,function(e,o){o===google.maps.DirectionsStatus.OK?(p.setDirections(e),b("onRouteComplete")):(q(o),b("onRouteError"))})}},s.TrafficLayer={toggle:function(){t&&null!==t.map?t.setMap(null):(t=new google.maps.TrafficLayer).setMap(m)}},s.TransitLayer={toggle:function(){n&&null!==n.map?n.setMap(null):(n=new google.maps.TransitLayer).setMap(m)}},s.BicycleLayer={toggle:function(){o&&null!==o.map?o.setMap(null):(o=new google.maps.BicyclingLayer).setMap(m)}},s.GeoLocation={set:function(){I()}},s.getURL={Android:function(e){return r.AndroidMapLink+"?q="+e},ios:function(e){return r.iOSAppleMapLink+"?q="+e},WindowsPhone:function(e){return r.WP7MapLink+e},Desktop:function(e){return r.DesktopMapLink+"?q="+e},Native:function(e){return-1<navigator.userAgent.toLowerCase().indexOf("android")?s.getURL.Android(e):navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)?s.getURL.ios(e):navigator.userAgent.match(/Windows Phone/i)?s.getURL.WindowsPhone(e):s.getURL.Desktop(e)}},s});