/*! simplegmaps - v1.1.2 - 2016-01-20
* https://github.com/SubZane/simplegmaps
* Copyright (c) 2016 Andreas Norman; Licensed MIT */
!function(a){function b(b,d){function e(){d.MapOptions.center&&(d.MapOptions.center=g(d.MapOptions.center)),d.MapOptions.zoom||(d.MapOptions.zoom=8),i(),a(d.getRouteButton).length>0&&a(d.getTravelMode).length>0&&m(this),a(d.geoLocationButton).length>0&&a(d.geoLocationButton).on("click",function(a){a.preventDefault(),n(J.map)}.bind(this)),F("onInit")}function f(a,b){for(var c=new google.maps.LatLngBounds,d=0;d<b.length;++d)c.extend(b[d].getPosition());if(c.getNorthEast().equals(c.getSouthWest())){var e=new google.maps.LatLng(c.getNorthEast().lat()+.002,c.getNorthEast().lng()+.002),f=new google.maps.LatLng(c.getNorthEast().lat()-.002,c.getNorthEast().lng()-.002);c.extend(e),c.extend(f)}try{a.fitBounds(c),a.setCenter(c.getCenter())}catch(g){}}function g(a){var b=a.split(/,\s*/);return $latlng=new google.maps.LatLng(parseFloat(b[0]),parseFloat(b[1]))}function h(){if(a(d.externalLink).length>0){var b=J.markers[0].position.toString(),c="?q="+b;navigator.userAgent.toLowerCase().indexOf("android")>-1?a(d.externalLink).attr("href",d.AndroidMapLink+c):navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?a(d.externalLink).attr("href",d.AppleMapLink+c):a(d.externalLink).attr("href",d.GenericMapLink+c)}}function i(){var b=(new google.maps.InfoWindow,new google.maps.Geocoder),c="",e=[],i=I.clone(),k=d.AutoComplete;k&&A(),a(d.SearchButton).length>0&&a(d.SearchBox).length>0?(a(d.SearchButton).on("click",function(b){b.preventDefault();var c=a(d.SearchBox).val();C(c,J.map)}),a(d.SearchBox).keypress(function(b){if(13===b.which){var c=a(d.SearchBox).val();C(c,J.map)}})):a(d.getRouteButton).length>0&&a(d.getFromAddress).length>0&&a(d.getFromAddress).keypress(function(b){13===b.which&&a(d.getRouteButton).trigger("click")});var l=new google.maps.Map(I[0],d.MapOptions);i.find("div.map-marker").each(function(){if(a(this).attr("data-latlng"))c=a(this),j(c.data("icon"),c.data("icon2x"),function(b){var d=new google.maps.Marker({map:l,title:c.data("title"),position:g(c.data("latlng")),icon:b,center:c.data("center")});if(c.has("div.map-infowindow").length>0){var f=new google.maps.InfoWindow({content:c.find("div.map-infowindow").parent().html()});google.maps.event.addListener(d,"click",function(){f.open(l,d)})}else if(c.has("div.map-custom-infowindow").length>0){var h=c.find("div.map-custom-infowindow").parent().html();google.maps.event.addListener(d,"click",function(){a("#simplegmaps-c-iw").remove(),a('<div id="simplegmaps-c-iw"></div>').insertAfter(I),a("#simplegmaps-c-iw").html(h),a("#simplegmaps-c-iw .close").on("click",function(b){b.preventDefault(),a("#simplegmaps-c-iw").remove()})})}e.push(d)});else if(a(this).attr("data-address")){var d=a(this);b.geocode({address:d.data("address")},function(b,c){c===google.maps.GeocoderStatus.OK&&j(d.data("icon"),d.data("icon2x"),function(c){var f=new google.maps.Marker({map:l,title:d.data("title"),position:b[0].geometry.location,icon:c,center:d.data("center")});if(d.has("div.map-infowindow").length>0){var g=new google.maps.InfoWindow({content:d.find("div.map-infowindow").parent().html()});google.maps.event.addListener(f,"click",function(){g.open(l,f)})}else if(d.has("div.map-custom-infowindow").length>0){var h=d.find("div.map-custom-infowindow").parent().html();google.maps.event.addListener(f,"click",function(){a("#simplegmaps-c-iw").remove(),a('<div id="simplegmaps-c-iw"></div>').insertAfter(I),a("#simplegmaps-c-iw").html(h),a("#simplegmaps-c-iw .close").on("click",function(b){b.preventDefault(),a("#simplegmaps-c-iw").remove()})})}e.push(f)})})}}),google.maps.event.addListenerOnce(l,"idle",function(){var a=new google.maps.LatLngBounds,b={};if(e.length>0)if(d.ZoomToFitBounds===!0)f(l,e);else{var c=e.filter(function(a){return a.center===!0});"function"==typeof c[0].position.lat?(b.lat=e[0].position.lat(),b.lng=e[0].position.lng()):b=c[0].position,l.setCenter(b)}else d.MapOptions.center||l.setCenter(a.getCenter());J={map:l,markers:e},h(),d.GeoLocation&&n(J.map),F("onMapDrawn")})}function j(a,b,c){var d="",e=new Image;"undefined"==typeof a||"undefined"==typeof b?c(null):window.devicePixelRatio>1.5&&b?(e.onload=function(){var a={url:b,size:new google.maps.Size(e.naturalWidth/2,e.naturalHeight/2),scaledSize:new google.maps.Size(e.naturalWidth/2,e.naturalHeight/2),origin:new google.maps.Point(0,0)};c(a)},e.src=b):a?(e.onload=function(){var b={url:a,size:new google.maps.Size(e.naturalWidth,e.naturalHeight)};c(b)},e.src=a):c(d)}function k(b){var c=J.markers;directionsDisplay.setMap(J.map),directionsDisplay.setPanel(a(d.routeDirections)[0]);var e={origin:b,destination:c[0].position,travelMode:google.maps.TravelMode[currentTravelmode]};jQuery.extend(e,d.DirectionsRequestOptions),directionsService.route(e,function(a,b){b===google.maps.DirectionsStatus.OK&&(directionsDisplay.setDirections(a),F("onRouteDrawn"))})}function l(a){var b=M.length;currentTravelmode=d.defaultTravelMode;for(var c=0;b>c;c++)M[c]===a&&(currentTravelmode=a)}function m(){directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({draggable:!0}),a(d.getRouteButton).on("click",function(b){b.preventDefault();var c=a(d.getTravelMode).val();l(c),a(d.getFromAddress).val().length>0&&k(a(d.getFromAddress).val())})}function n(a){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){var c=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);a.setCenter(c)},function(){q(a,!0)}):q(a,!1)}function o(){K&&null!==K.map?K.setMap(null):(K=new google.maps.TrafficLayer,K.setMap(J.map))}function p(){L&&null!==L.map?L.setMap(null):(L=new google.maps.BicyclingLayer,L.setMap(J.map))}function q(a,b){var c;c=b?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.";{var d={map:a,position:new google.maps.LatLng(60,105),content:c};new google.maps.InfoWindow(d)}J.setCenter(d.position)}function r(){n(J.map)}function s(a){var b=d.AndroidMapLink+"?q="+a;return b}function t(a){var b=d.iOSAppleMapLink+"?q="+a;return b}function u(a){var b=d.WP7MapLink+a;return b}function v(a){var b=d.DesktopMapLink+"?q="+a;return b}function w(a){var b="";return b=x()?s(a):y()?t(a):z()?u(a):v(a)}function x(){return navigator.userAgent.toLowerCase().indexOf("android")>-1?!0:!1}function y(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)?!0:!1}function z(){return navigator.userAgent.match(/Windows Phone/i)?!0:!1}function A(){var b=a(d.SearchBox)[0],c=d.AutoCompleteOptions;G=new google.maps.places.Autocomplete(b,c),a(d.getRouteButton).length>0&&a(d.getFromAddress).length>0?G.addListener("place_changed",function(){a(d.getRouteButton).trigger("click")}):G.addListener("place_changed",B)}function B(){var a=G.getPlace();if(a.geometry){if(d.AutoCompleteOptions.moveMap&&(J.map.panTo(a.geometry.location),J.map.setZoom(15)),d.AutoCompleteOptions.setMarker){new google.maps.Marker({map:J.map,position:a.geometry.location})}F("onAutoCompletePlaceChanged")}}function C(a,b){var c=new google.maps.Geocoder;c.geocode({address:a},function(a,c){if(c===google.maps.GeocoderStatus.OK){b.setCenter(a[0].geometry.location);{new google.maps.Marker({map:b,position:a[0].geometry.location})}}})}function D(a,b){return b?void(d[a]=b):d[a]}function E(){I.each(function(){var b=a(this);F("onDestroy"),b.removeData("plugin_"+c)})}function F(a){void 0!==d[a]&&d[a].call(H)}var G,H=b,I=a(b),J=!1,K=!1,L=!1,M=["DRIVING","WALKING","BICYCLING","TRANSIT"];return d=a.extend({},a.fn[c].defaults,d),e(),{option:D,destroy:E,getNativeMapLink:w,toggleTrafficLayer:o,toggleBicycleLayer:p,getGoogleMapLink:s,getAppleMapsLink:t,getWindowsPhone7MapLink:u,getDesktopMapLink:v,setGeoLocation:r}}var c="simplegmaps";a.fn[c]=function(d){if("string"==typeof arguments[0]){var e,f=arguments[0],g=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!a.data(this,"plugin_"+c)||"function"!=typeof a.data(this,"plugin_"+c)[f])throw new Error("Method "+f+" does not exist on jQuery."+c);e=a.data(this,"plugin_"+c)[f].apply(this,g)}),void 0!==e?e:this}return"object"!=typeof d&&d?void 0:this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})},a.fn[c].defaults={GeoLocation:!1,ZoomToFitBounds:!0,MapOptions:{draggable:!0,zoom:8,scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},SearchBox:"#simplegmaps-searchbox",SearchButton:"#simplegmaps-searchbutton",AutoComplete:!1,AutoCompleteOptions:{types:["geocode"],componentRestrictions:{country:"se"},moveMap:!1,setMarker:!1},iOSAppleMapLink:"http://maps.apple.com/",iOSGoogleMapLink:"comgooglemaps://",AndroidMapLink:"https://maps.google.se/maps",WP7MapLink:"maps:",DesktopMapLink:"http://www.google.com/maps",getRouteButton:"#simplegmaps-getroute",getTravelMode:"#simplegmaps-travelmode input:checked",routeDirections:"#simplegmaps-directions",externalLink:"#simplegmaps-external",getFromAddress:"#simplegmaps-fromaddress",defaultTravelMode:"DRIVING",onInit:function(){},onLoad:function(){},onDestroy:function(){},onRouteDrawn:function(){},onMapDrawn:function(){},onAutoCompletePlaceChanged:function(){}}}(jQuery);