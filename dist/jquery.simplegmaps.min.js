/*! simplegmaps - v0.6.0 - 2015-03-15
* https://github.com/SubZane/simplegmaps
* Copyright (c) 2015 Andreas Norman; Licensed MIT */
!function(a){var b="simplegmaps",c="plugin_"+b,d=["DRIVING","WALKING","BICYCLING"],e={GeoLocation:!1,MapOptions:{draggable:!0,zoom:8,scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},AppleMapLink:"http://maps.apple.com/",AndroidMapLink:"http://maps.google.com/maps",GenericMapLink:"http://www.google.com/maps",getRouteButton:"#simplegmaps-getroute",getTravelMode:"#simplegmaps-travelmode",routeDirections:"#simplegmaps-directions",externalLink:"#simplegmaps-external",getFromAddress:"#simplegmaps-fromaddress",defaultTravelMode:"DRIVING"},f=function(a,b){for(var c=new google.maps.LatLngBounds,d=0;d<b.length;++d)c.extend(b[d].getPosition());if(c.getNorthEast().equals(c.getSouthWest())){var e=new google.maps.LatLng(c.getNorthEast().lat()+.002,c.getNorthEast().lng()+.002),f=new google.maps.LatLng(c.getNorthEast().lat()-.002,c.getNorthEast().lng()-.002);c.extend(e),c.extend(f)}try{a.fitBounds(c),a.setCenter(c.getCenter())}catch(g){}},g=function(a){var b=a.split(/,\s*/);return $latlng=new google.maps.LatLng(parseFloat(b[0]),parseFloat(b[1]))},h=function(b){if(a(b.options.externalLink).length>0){var c=b.Map.markers[0].position.toString(),d="?q="+c;navigator.userAgent.toLowerCase().indexOf("android")>-1?a(b.options.externalLink).attr("href",b.options.AndroidMapLink+d):navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?a(b.options.externalLink).attr("href",b.options.AppleMapLink+d):a(b.options.externalLink).attr("href",b.options.GenericMapLink+d)}},i=function(b,c){var d=(new google.maps.InfoWindow,new google.maps.Geocoder),e=[],i=c.clone(),j=({zoom:8,center:new google.maps.LatLng(-34.397,150.644)},new google.maps.Map(c[0],b.options.MapOptions));i.find("div.map-marker").each(function(){if(a(this).attr("data-latlng")){var c=new google.maps.Marker({map:j,title:a(this).data("title"),position:g(a(this).data("latlng")),icon:a(this).data("icon")});if(a(this).has("div.map-infowindow").length>0){var f=new google.maps.InfoWindow({content:a(this).find("div.map-infowindow").parent().html()});google.maps.event.addListener(c,"click",function(){f.open(j,c)})}else if(a(this).has("div.map-custom-infowindow").length>0){var h=a(this).find("div.map-custom-infowindow").parent().html();google.maps.event.addListener(c,"click",function(){a("#simplegmaps-c-iw").remove(),a('<div id="simplegmaps-c-iw"></div>').insertAfter(b.element.selector),a("#simplegmaps-c-iw").html(h),a("#simplegmaps-c-iw .close").on("click",function(b){b.preventDefault(),a("#simplegmaps-c-iw").remove()})})}e.push(c)}else if(a(this).attr("data-address")){var i=a(this);d.geocode({address:a(this).data("address")},function(c,d){if(d===google.maps.GeocoderStatus.OK){var f=new google.maps.Marker({map:j,title:i.data("title"),position:c[0].geometry.location,icon:i.data("icon")});if(i.has("div.map-infowindow").length>0){var g=new google.maps.InfoWindow({content:i.find("div.map-infowindow").parent().html()});google.maps.event.addListener(f,"click",function(){g.open(j,f)})}else if(i.has("div.map-custom-infowindow").length>0){var h=i.find("div.map-custom-infowindow").parent().html();google.maps.event.addListener(f,"click",function(){a("#simplegmaps-c-iw").remove(),a('<div id="simplegmaps-c-iw"></div>').insertAfter(b.element.selector),a("#simplegmaps-c-iw").html(h),a("#simplegmaps-c-iw .close").on("click",function(b){b.preventDefault(),a("#simplegmaps-c-iw").remove()})})}e.push(f)}})}}),google.maps.event.addListenerOnce(j,"idle",function(){if(e.length>0)f(j,e);else if(!b.options.MapOptions.center){var a=new google.maps.LatLngBounds;j.fitBounds(a),j.setCenter(a.getCenter())}b.Map={map:j,markers:e},h(b),b.options.GeoLocation&&m(b.Map.map)})},j=function(b,c){var d=b.Map.markers;b.directionsDisplay.setMap(b.Map.map),b.directionsDisplay.setPanel(a(b.options.routeDirections)[0]);var e={origin:c,destination:d[0].position,travelMode:google.maps.TravelMode[b.currentTravelmode]};b.directionsService.route(e,function(a,c){c===google.maps.DirectionsStatus.OK&&b.directionsDisplay.setDirections(a)})},k=function(a,b){var c=a.TravelModes.length;a.currentTravelmode=a.options.defaultTravelMode;for(var d=0;c>d;d++)a.TravelModes[d]===b&&(a.currentTravelmode=b)},l=function(b){b.directionsService=new google.maps.DirectionsService,b.directionsDisplay=new google.maps.DirectionsRenderer({draggable:!0}),a(b.options.getRouteButton).on("click",function(c){c.preventDefault();var d=a(b.options.getTravelMode).val();k(b,d),a(b.options.getFromAddress).val().length>0&&j(b,a(b.options.getFromAddress).val())})},m=function(a){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){var c=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);a.setCenter(c)},function(){p(a,!0)}):p(a,!1)},n=function(a){a.trafficLayer&&null!==a.trafficLayer.map?a.trafficLayer.setMap(null):(a.trafficLayer=new google.maps.TrafficLayer,a.trafficLayer.setMap(a.Map.map))},o=function(a){a.bicycleLayer&&null!==a.bicycleLayer.map?a.bicycleLayer.setMap(null):(a.bicycleLayer=new google.maps.BicyclingLayer,a.bicycleLayer.setMap(a.Map.map))},p=function(a,b){var c;c=b?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.";{var d={map:a,position:new google.maps.LatLng(60,105),content:c};new google.maps.InfoWindow(d)}instance.Map.setCenter(d.position)},q=function(){this.options=a.extend({},e),this.TravelModes=a.extend([],d)};q.prototype={init:function(b){if(a.extend(this.options,b),this.options.MapOptions.center&&(this.options.MapOptions.center=g(this.options.MapOptions.center)),this.options.MapOptions.zoom||(this.options.MapOptions.zoom=8),i(this,this.element),a(this.options.getRouteButton).length>0&&a(this.options.getTravelMode).length>0&&l(this),a(this.options.geoLocationButton).length>0){a(this.options.geoLocationButton).on("click",function(a){a.preventDefault(),m(this)}.bind(this))}},getMarkers:function(){return this.Map.map},getMap:function(){return this.Map.map},toggleTrafficLayer:function(){n(this)},toggleBicycleLayer:function(){o(this)},getPosition:function(){},setGeoLocation:function(){m(this.Map.map)},addMethod:function(b){this.extensions=a.extend(this.extensions,b)},destroy:function(){this.element.data(c,null)}},a.fn[b]=function(d){var e,f;if(this.data(c)instanceof q||this.data(c,new q(this)),f=this.data(c),f.element=this,"undefined"==typeof d||"object"==typeof d)"function"==typeof f.init&&f.init(d);else{if("string"==typeof d&&"function"==typeof f[d])return e=Array.prototype.slice.call(arguments,1),f[d].apply(f,e);a.error("Method "+d+" does not exist on jQuery."+b)}}}(jQuery,window,document);