/*! simplegmaps - v0.7.1 - 2015-07-31
* https://github.com/SubZane/simplegmaps
* Copyright (c) 2015 Andreas Norman; Licensed MIT */
!function(a){function b(b,d){function e(){d.MapOptions.center&&(d.MapOptions.center=i(d.MapOptions.center)),d.MapOptions.zoom||(d.MapOptions.zoom=8),k(),a(d.getRouteButton).length>0&&a(d.getTravelMode).length>0&&n(this),a(d.geoLocationButton).length>0&&a(d.geoLocationButton).on("click",function(a){a.preventDefault(),o(x.map)}.bind(this)),u("onInit")}function f(a,b){for(var c=new google.maps.LatLngBounds,d=0;d<b.length;++d)c.extend(b[d].getPosition());if(c.getNorthEast().equals(c.getSouthWest())){var e=new google.maps.LatLng(c.getNorthEast().lat()+.002,c.getNorthEast().lng()+.002),f=new google.maps.LatLng(c.getNorthEast().lat()-.002,c.getNorthEast().lng()-.002);c.extend(e),c.extend(f)}try{a.fitBounds(c),a.setCenter(c.getCenter())}catch(g){}}function g(){h();x.markers.forEach(function(){})}function h(){var a=new google.maps.Geocoder,b="100 W 51rd St, New York, NY, United States",c=[];a.geocode({address:b},function(a,b){if(b===google.maps.GeocoderStatus.OK){var d=new google.maps.Marker({map:x.map,position:a[0].geometry.location});c.push(d)}}),google.maps.event.addListenerOnce(map,"idle",function(){if(c.length>0)f(map,c);else if(!d.MapOptions.center){var a=new google.maps.LatLngBounds;map.fitBounds(a),map.setCenter(a.getCenter())}x={map:map,markers:c},j(),d.GeoLocation&&o(x.map)})}function i(a){var b=a.split(/,\s*/);return $latlng=new google.maps.LatLng(parseFloat(b[0]),parseFloat(b[1]))}function j(){if(a(d.externalLink).length>0){var b=x.markers[0].position.toString(),c="?q="+b;navigator.userAgent.toLowerCase().indexOf("android")>-1?a(d.externalLink).attr("href",d.AndroidMapLink+c):navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?a(d.externalLink).attr("href",d.AppleMapLink+c):a(d.externalLink).attr("href",d.GenericMapLink+c)}}function k(){var b=(new google.maps.InfoWindow,new google.maps.Geocoder),c=[],e=w.clone(),g=({zoom:8,center:new google.maps.LatLng(-34.397,150.644)},new google.maps.Map(w[0],d.MapOptions));e.find("div.map-marker").each(function(){if(a(this).attr("data-latlng")){var d=new google.maps.Marker({map:g,title:a(this).data("title"),position:i(a(this).data("latlng")),icon:a(this).data("icon")});if(a(this).has("div.map-infowindow").length>0){var e=new google.maps.InfoWindow({content:a(this).find("div.map-infowindow").parent().html()});google.maps.event.addListener(d,"click",function(){e.open(g,d)})}else if(a(this).has("div.map-custom-infowindow").length>0){var f=a(this).find("div.map-custom-infowindow").parent().html();google.maps.event.addListener(d,"click",function(){a("#simplegmaps-c-iw").remove(),a('<div id="simplegmaps-c-iw"></div>').insertAfter(w),a("#simplegmaps-c-iw").html(f),a("#simplegmaps-c-iw .close").on("click",function(b){b.preventDefault(),a("#simplegmaps-c-iw").remove()})})}c.push(d)}else if(a(this).attr("data-address")){var h=a(this);b.geocode({address:a(this).data("address")},function(b,d){if(d===google.maps.GeocoderStatus.OK){var e=new google.maps.Marker({map:g,title:h.data("title"),position:b[0].geometry.location,icon:h.data("icon")});if(h.has("div.map-infowindow").length>0){var f=new google.maps.InfoWindow({content:h.find("div.map-infowindow").parent().html()});google.maps.event.addListener(e,"click",function(){f.open(g,e)})}else if(h.has("div.map-custom-infowindow").length>0){var i=h.find("div.map-custom-infowindow").parent().html();google.maps.event.addListener(e,"click",function(){a("#simplegmaps-c-iw").remove(),a('<div id="simplegmaps-c-iw"></div>').insertAfter(w),a("#simplegmaps-c-iw").html(i),a("#simplegmaps-c-iw .close").on("click",function(b){b.preventDefault(),a("#simplegmaps-c-iw").remove()})})}c.push(e)}})}}),google.maps.event.addListenerOnce(g,"idle",function(){if(c.length>0)f(g,c);else if(!d.MapOptions.center){var a=new google.maps.LatLngBounds;g.fitBounds(a),g.setCenter(a.getCenter())}x={map:g,markers:c},j(),d.GeoLocation&&o(x.map),u("onMapDrawn")})}function l(b){var c=x.markers;directionsDisplay.setMap(x.map),directionsDisplay.setPanel(a(d.routeDirections)[0]);var e={origin:b,destination:c[0].position,travelMode:google.maps.TravelMode[currentTravelmode]};jQuery.extend(e,d.DirectionsRequestOptions),directionsService.route(e,function(a,b){b===google.maps.DirectionsStatus.OK&&(directionsDisplay.setDirections(a),u("onRouteDrawn"))})}function m(a){var b=A.length;currentTravelmode=d.defaultTravelMode;for(var c=0;b>c;c++)A[c]===a&&(currentTravelmode=a)}function n(){directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({draggable:!0}),a(d.getRouteButton).on("click",function(b){b.preventDefault();var c=a(d.getTravelMode).val();m(c),a(d.getFromAddress).val().length>0&&l(a(d.getFromAddress).val())})}function o(a){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){var c=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);a.setCenter(c)},function(){r(a,!0)}):r(a,!1)}function p(){y&&null!==y.map?y.setMap(null):(y=new google.maps.TrafficLayer,y.setMap(x.map))}function q(){z&&null!==z.map?z.setMap(null):(z=new google.maps.BicyclingLayer,z.setMap(x.map))}function r(a,b){var c;c=b?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.";{var d={map:a,position:new google.maps.LatLng(60,105),content:c};new google.maps.InfoWindow(d)}x.setCenter(d.position)}function s(a,b){return b?void(d[a]=b):d[a]}function t(){w.each(function(){var b=a(this);u("onDestroy"),b.removeData("plugin_"+c)})}function u(a){void 0!==d[a]&&d[a].call(v)}var v=b,w=a(b),x=!1,y=!1,z=!1,A=["DRIVING","WALKING","BICYCLING","TRANSIT"];return d=a.extend({},a.fn[c].defaults,d),e(),{option:s,destroy:t,toggleTrafficLayer:p,toggleBicycleLayer:q,addMarker:h,findClosestMarker:g}}var c="simplegmaps";a.fn[c]=function(d){if("string"==typeof arguments[0]){var e,f=arguments[0],g=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!a.data(this,"plugin_"+c)||"function"!=typeof a.data(this,"plugin_"+c)[f])throw new Error("Method "+f+" does not exist on jQuery."+c);e=a.data(this,"plugin_"+c)[f].apply(this,g)}),void 0!==e?e:this}return"object"!=typeof d&&d?void 0:this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})},a.fn[c].defaults={GeoLocation:!1,MapOptions:{draggable:!0,zoom:8,scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},AppleMapLink:"http://maps.apple.com/",AndroidMapLink:"http://maps.google.com/maps",GenericMapLink:"http://www.google.com/maps",getRouteButton:"#simplegmaps-getroute",getTravelMode:"#simplegmaps-travelmode",routeDirections:"#simplegmaps-directions",externalLink:"#simplegmaps-external",getFromAddress:"#simplegmaps-fromaddress",defaultTravelMode:"DRIVING",onInit:function(){},onLoad:function(){},onDestroy:function(){},onRouteDrawn:function(){},onMapDrawn:function(){}}}(jQuery);