/*! simplegmaps - v1.1.3 - 2016-01-24
* https://github.com/SubZane/simplegmaps
* Copyright (c) 2016 Andreas Norman; Licensed MIT */
!function($){function e(e,n){function o(){n.MapOptions.center&&(n.MapOptions.center=i(n.MapOptions.center)),n.MapOptions.zoom||(n.MapOptions.zoom=8),l(),$(n.getRouteButton).length>0&&$(n.getTravelMode).length>0&&f(this),$(n.geoLocationButton).length>0&&$(n.geoLocationButton).on("click",function(e){e.preventDefault(),v(E.map)}.bind(this)),z("onInit")}function a(e,t){for(var n=new google.maps.LatLngBounds,o=0;o<t.length;++o)n.extend(t[o].getPosition());if(n.getNorthEast().equals(n.getSouthWest())){var a=new google.maps.LatLng(n.getNorthEast().lat()+.002,n.getNorthEast().lng()+.002),i=new google.maps.LatLng(n.getNorthEast().lat()-.002,n.getNorthEast().lng()-.002);n.extend(a),n.extend(i)}try{e.fitBounds(n),e.setCenter(n.getCenter())}catch(r){}}function i(e){var t=e.split(/,\s*/);return $latlng=new google.maps.LatLng(parseFloat(t[0]),parseFloat(t[1])),$latlng}function r(){if($(n.externalLink).length>0){var e=E.markers[0].position.toString(),t="?q="+e;navigator.userAgent.toLowerCase().indexOf("android")>-1?$(n.externalLink).attr("href",n.AndroidMapLink+t):navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?$(n.externalLink).attr("href",n.AppleMapLink+t):$(n.externalLink).attr("href",n.GenericMapLink+t)}}function s(){}function l(){var e=new google.maps.InfoWindow,t=new google.maps.Geocoder,o=[],s=N.clone(),l=n.AutoComplete;l&&P(),$(n.SearchButton).length>0&&$(n.SearchBox).length>0?($(n.SearchButton).on("click",function(e){e.preventDefault();var t=$(n.SearchBox).val();G(t,E.map)}),$(n.SearchBox).keypress(function(e){if(13===e.which){var t=$(n.SearchBox).val();G(t,E.map)}})):$(n.getRouteButton).length>0&&$(n.getFromAddress).length>0&&$(n.getFromAddress).keypress(function(e){13===e.which&&$(n.getRouteButton).trigger("click")});var p=new google.maps.Map(N[0],n.MapOptions);console.log("map start"),s.find("div.map-marker").each(function(e){if($(this).attr("data-latlng")){var n=$(this);console.log(n),c(n.data("icon"),n.data("icon2x"),function(e){var t=new google.maps.Marker({map:p,title:n.data("title"),position:i(n.data("latlng")),icon:e,center:n.data("center")});if(n.has("div.map-infowindow").length>0){var a=new google.maps.InfoWindow({content:n.find("div.map-infowindow").parent().html()});google.maps.event.addListener(t,"click",function(){a.open(p,t)})}else if(n.has("div.map-custom-infowindow").length>0){var r=n.find("div.map-custom-infowindow").parent().html();google.maps.event.addListener(t,"click",function(){$("#simplegmaps-c-iw").remove(),$('<div id="simplegmaps-c-iw"></div>').insertAfter(N),$("#simplegmaps-c-iw").html(r),$("#simplegmaps-c-iw .close").on("click",function(e){e.preventDefault(),$("#simplegmaps-c-iw").remove()})})}o.push(t)})}else if($(this).attr("data-address")){var a=$(this);t.geocode({address:a.data("address")},function(e,t){t===google.maps.GeocoderStatus.OK&&c(a.data("icon"),a.data("icon2x"),function(t){var n=new google.maps.Marker({map:p,title:a.data("title"),position:e[0].geometry.location,icon:t,center:a.data("center")});if(a.has("div.map-infowindow").length>0){var i=new google.maps.InfoWindow({content:a.find("div.map-infowindow").parent().html()});google.maps.event.addListener(n,"click",function(){i.open(p,n)})}else if(a.has("div.map-custom-infowindow").length>0){var r=a.find("div.map-custom-infowindow").parent().html();google.maps.event.addListener(n,"click",function(){$("#simplegmaps-c-iw").remove(),$('<div id="simplegmaps-c-iw"></div>').insertAfter(N),$("#simplegmaps-c-iw").html(r),$("#simplegmaps-c-iw .close").on("click",function(e){e.preventDefault(),$("#simplegmaps-c-iw").remove()})})}o.push(n)})})}}),google.maps.event.addListenerOnce(p,"idle",function(){var e=new google.maps.LatLngBounds,t={};if(o.length>0)if(n.ZoomToFitBounds===!0)a(p,o);else{var i=o.filter(function(e){return e.center===!0});"function"==typeof i[0].position.lat?(t.lat=o[0].position.lat(),t.lng=o[0].position.lng()):t=i[0].position,p.setCenter(t)}else n.MapOptions.center||p.setCenter(e.getCenter());E={map:p,markers:o},r(),n.GeoLocation&&v(E.map),z("onMapDrawn")})}function p(e,t){var n=e.lat();t(n)}function g(e,t){var n=e.lng();t(n)}function c(e,t,n){var o="",a=new Image;"undefined"==typeof e||"undefined"==typeof t?n(null):window.devicePixelRatio>1.5&&t?(a.onload=function(){var e={url:t,size:new google.maps.Size(a.naturalWidth/2,a.naturalHeight/2),scaledSize:new google.maps.Size(a.naturalWidth/2,a.naturalHeight/2),origin:new google.maps.Point(0,0)};n(e)},a.src=t):e?(a.onload=function(){var t={url:e,size:new google.maps.Size(a.naturalWidth,a.naturalHeight)};n(t)},a.src=e):n(o)}function u(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return e}function m(e){var t=E.markers;directionsDisplay.setMap(E.map),directionsDisplay.setPanel($(n.routeDirections)[0]);var o={origin:e,destination:t[0].position,travelMode:google.maps.TravelMode[currentTravelmode]};jQuery.extend(o,n.DirectionsRequestOptions),directionsService.route(o,function(e,t){t===google.maps.DirectionsStatus.OK&&(directionsDisplay.setDirections(e),z("onRouteDrawn"))})}function d(e){var t=q.length;currentTravelmode=n.defaultTravelMode;for(var o=0;t>o;o++)q[o]===e&&(currentTravelmode=e)}function f(){directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({draggable:!0}),$(n.getRouteButton).on("click",function(e){e.preventDefault();var t=$(n.getTravelMode).val();d(t),$(n.getFromAddress).val().length>0&&m($(n.getFromAddress).val())})}function v(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);e.setCenter(n)},function(){L(e,!0)}):L(e,!1)}function h(){_&&null!==_.map?_.setMap(null):(_=new google.maps.TrafficLayer,_.setMap(E.map))}function w(){b&&null!==b.map?b.setMap(null):(b=new google.maps.BicyclingLayer,b.setMap(E.map))}function L(e,t){var n;n=t?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.";var o={map:e,position:new google.maps.LatLng(60,105),content:n},a=new google.maps.InfoWindow(o);E.setCenter(o.position)}function x(){v(E.map)}function k(){var e=E.map.getCenter();google.maps.event.trigger(E.map,"resize"),E.map.setCenter(e)}function M(e){var t=n.AndroidMapLink+"?q="+e;return t}function y(e){var t=n.iOSAppleMapLink+"?q="+e;return t}function A(e){var t=n.WP7MapLink+e;return t}function C(e){var t=n.DesktopMapLink+"?q="+e;return t}function D(e){var t="";return t=B()?M(e):S()?y(e):T()?A(e):C(e)}function B(){return navigator.userAgent.toLowerCase().indexOf("android")>-1?!0:!1}function S(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)?!0:!1}function O(){return navigator.userAgent.match(/BlackBerry/i)?!0:!1}function T(){return navigator.userAgent.match(/Windows Phone/i)?!0:!1}function P(){var e=$(n.SearchBox)[0],t=n.AutoCompleteOptions;j=new google.maps.places.Autocomplete(e,t),$(n.getRouteButton).length>0&&$(n.getFromAddress).length>0?j.addListener("place_changed",function(){$(n.getRouteButton).trigger("click")}):j.addListener("place_changed",R)}function R(){var e=j.getPlace();if(e.geometry){if(n.AutoCompleteOptions.moveMap&&(E.map.panTo(e.geometry.location),E.map.setZoom(15)),n.AutoCompleteOptions.setMarker)var t=new google.maps.Marker({map:E.map,position:e.geometry.location});z("onAutoCompletePlaceChanged")}}function G(e,t){var n=new google.maps.Geocoder;n.geocode({address:e},function(e,n){if(n===google.maps.GeocoderStatus.OK){t.setCenter(e[0].geometry.location);var o=new google.maps.Marker({map:t,position:e[0].geometry.location})}})}function I(e,t){return t?void(n[e]=t):n[e]}function W(){N.each(function(){var e=this,n=$(this);z("onDestroy"),n.removeData("plugin_"+t)})}function z(e){void 0!==n[e]&&n[e].call(F)}var F=e,N=$(e),E=!1,_=!1,b=!1,q=["DRIVING","WALKING","BICYCLING","TRANSIT"],j;return n=$.extend({},$.fn[t].defaults,n),o(),{option:I,destroy:W,getNativeMapLink:D,toggleTrafficLayer:h,toggleBicycleLayer:w,getGoogleMapLink:M,getAppleMapsLink:y,getWindowsPhone7MapLink:A,getDesktopMapLink:C,setGeoLocation:x,reCenter:k}}var t="simplegmaps";$.fn[t]=function(n){if("string"==typeof arguments[0]){var o=arguments[0],a=Array.prototype.slice.call(arguments,1),i;return this.each(function(){if(!$.data(this,"plugin_"+t)||"function"!=typeof $.data(this,"plugin_"+t)[o])throw new Error("Method "+o+" does not exist on jQuery."+t);i=$.data(this,"plugin_"+t)[o].apply(this,a)}),void 0!==i?i:this}return"object"!=typeof n&&n?void 0:this.each(function(){$.data(this,"plugin_"+t)||$.data(this,"plugin_"+t,new e(this,n))})},$.fn[t].defaults={GeoLocation:!1,ZoomToFitBounds:!0,MapOptions:{draggable:!0,zoom:8,scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},SearchBox:"#simplegmaps-searchbox",SearchButton:"#simplegmaps-searchbutton",AutoComplete:!1,AutoCompleteOptions:{types:["geocode"],componentRestrictions:{country:"se"},moveMap:!1,setMarker:!1},iOSAppleMapLink:"http://maps.apple.com/",iOSGoogleMapLink:"comgooglemaps://",AndroidMapLink:"https://maps.google.se/maps",WP7MapLink:"maps:",DesktopMapLink:"http://www.google.com/maps",getRouteButton:"#simplegmaps-getroute",getTravelMode:"#simplegmaps-travelmode input:checked",routeDirections:"#simplegmaps-directions",externalLink:"#simplegmaps-external",getFromAddress:"#simplegmaps-fromaddress",defaultTravelMode:"DRIVING",onInit:function(){},onLoad:function(){},onDestroy:function(){},onRouteDrawn:function(){},onMapDrawn:function(){},onAutoCompletePlaceChanged:function(){}}}(jQuery);