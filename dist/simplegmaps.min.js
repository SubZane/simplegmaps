/*! simplegmaps - v2.3.2 - 2019-12-05
* https://github.com/SubZane/simplegmaps
* Copyright (c) 2019 Andreas Norman; Licensed MIT */

var simplegmaps=function(){"use strict";return function(){var r,a,e,t,i=[],n=!1,o={Driving:google.maps.TravelMode.DRIVING,Bicycling:google.maps.TravelMode.BICYCLING,Transit:google.maps.TravelMode.TRANSIT,Walking:google.maps.TravelMode.WALKING},s={Metric:google.maps.UnitSystem.METRIC,Imperial:google.maps.UnitSystem.IMPERIAL},l={travelMode:o.Driving,unitSystem:s.Metric},c=new google.maps.DirectionsRenderer({draggable:!0}),u=null,g=null,p=null,d={markers:[]},m=[],f=!1,h={debug:!1,multipleInfoWindows:!1,cluster:!1,ClusterImagePathPrefix:"img/markercluster/m",geolocateLimit:10,geolocateDelay:100,GeoLocation:!1,ZoomToFitBounds:!0,jsonsource:!1,AutoComplete:!1,AutoCompleteOptions:{types:["geocode"],componentRestrictions:{country:"se"},moveMap:!1,setMarker:!1},Search:{input:"",eventButton:"",AutoComplete:!1},MapOptions:{draggable:!0,zoom:7,center:"55.604981,13.003822",scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},Directions:{AutoComplete:!1,TravelMode:l.TravelMode,UnitSystem:l.UnitSystem,originInput:"",destination:"",eventButton:""},iOSAppleMapLink:"http://maps.apple.com/",iOSGoogleMapLink:"comgooglemaps://",AndroidMapLink:"https://maps.google.se/maps",WP7MapLink:"maps:",DesktopMapLink:"http://www.google.com/maps",onInit:function(){},onDestroy:function(){},onDrawMap:function(){},onSearchInit:function(){},onSearchComplete:function(){},onSearchFail:function(){},onZoomToFitBounds:function(){},onPlaceChanged:function(){},onDirectionsInit:function(){},onRouteComplete:function(){},onRouteError:function(){},onJSONConnectionFail:function(){},onJSONLoadFail:function(){},onJSONLoadSuccess:function(){}},v={},S=function(e){try{var t=JSON.parse(e);if(t&&"object"==typeof t&&null!==t)return t}catch(e){}return console.warn("Error parsing JSON file"),!1},M=function(n,o){I(n.latlng)?o(T(n.latlng)):I(n.address)&&setTimeout(k(n,function(e,t){b("status: "+e),b("response: "+t),e===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(console.warn("google.maps.GeocoderStatus.OVER_QUERY_LIMIT"),b("-- google.maps.GeocoderStatus.OVER_QUERY_LIMIT"),b("-- Unable to geolocate address. Removing marker."),o(!1)):e===google.maps.GeocoderStatus.OK?o(t):(n.latlng=null,b(e),b("No address or longitude/latitude located from address. Removing marker."),o(!1))}),r.geolocateDelay)},w=function(){b("-- placeMarkers --"),W(d.markers,function(e,t){b(e);var n={},o=new google.maps.Marker({title:e.title,center:e.center});m.push(o),o=y(o,e),n.position=e.position,n.icon=e.icon,o.setOptions(n),!1===r.cluster&&o.setMap(g),b(o.title)}),b("--- Cluster: "+r.cluster),!0===r.cluster&&new MarkerClusterer(g,m,{imagePath:r.ClusterImagePathPrefix});var e=new google.maps.LatLngBounds;if(0<m.length)if(!0===r.ZoomToFitBounds)b("ZoomToFitBounds"),O();else{b("NO - ZoomToFitBounds");var t=m.filter(function(e){return!0===e.center||"true"===e.center});I(t)?(b("centeredmarker:",t),g.setCenter(t[0].getPosition())):g.setCenter(m[0].getPosition())}else r.MapOptions.center||g.setCenter(e.getCenter());r.GeoLocation?(b("geolocation"),D(g)):b("no geolocation")},y=function(t,n){if(n.infoWindowContent)t.addListener("click",function(){!0===r.markerBounce&&C(t),!1===r.multipleInfoWindows&&0<i.length&&function(){for(var e=0;e<i.length;e++)i[e].close()}();var e=new google.maps.InfoWindow({content:n.infoWindowContent});e.open(g,t),i.push(e)});else if(n.CustominfoWindowContent){var o=n.CustominfoWindowContent;google.maps.event.addListener(t,"click",function(){!0===r.markerBounce&&C(t);var e=document.querySelector("#simplegmaps-c-iw");null!==e&&e.parentNode.removeChild(e),a.insertAdjacentHTML("afterend",'<div id="simplegmaps-c-iw"></div>'),document.querySelector("#simplegmaps-c-iw").innerHTML=o,document.querySelector("#simplegmaps-c-iw .close").addEventListener("click",function(e){e.preventDefault();var t=document.querySelector("#simplegmaps-c-iw");null!==t&&t.parentNode.removeChild(t)})})}else t.addListener("click",function(){!0===r.markerBounce&&C(t),!0===r.iconSwap.enabled&&L(t)});return t},C=function(e){void 0===e.getAnimation()||null===e.getAnimation()?(W(m,function(e,t){e.setAnimation(null)}),e.setAnimation(google.maps.Animation.BOUNCE)):e.setAnimation(null)},L=function(e){W(m,function(e,t){e.setIcon(null)}),e.setIcon(r.iconSwap.activeIcon)},k=function(e,n){I(e.latlng)?n(T(e.latlng)):I(e.address)&&u.geocode({address:e.address},function(e,t){t===google.maps.GeocoderStatus.OK?n(t,e[0].geometry.location):(google.maps.GeocoderStatus.OVER_QUERY_LIMIT,n(t,!1))})},A=function(t,n,o){var i=new Image;null===t&&null===n||""===t&&""===n?o(null):1.5<window.devicePixelRatio?null!==typeof n&&""!==n?(i.onload=function(){var e={url:n,size:new google.maps.Size(i.naturalWidth/2,i.naturalHeight/2),scaledSize:new google.maps.Size(i.naturalWidth/2,i.naturalHeight/2),origin:new google.maps.Point(0,0)};o(e)},i.src=n):null!==typeof t&&""!==t?(i.onload=function(){var e={url:t,size:new google.maps.Size(i.naturalWidth,i.naturalHeight)};o(e)},i.src=t):o(null):null!==typeof t&&""!==t?(i.onload=function(){var e={url:t,size:new google.maps.Size(i.naturalWidth,i.naturalHeight)};o(e)},i.src=t):o(null)},O=function(){for(var e=new google.maps.LatLngBounds,t=0;t<m.length;++t)e.extend(m[t].getPosition());if(e.getNorthEast().equals(e.getSouthWest())){var n=new google.maps.LatLng(e.getNorthEast().lat()+.002,e.getNorthEast().lng()+.002),o=new google.maps.LatLng(e.getNorthEast().lat()-.002,e.getNorthEast().lng()-.002);e.extend(n),e.extend(o)}try{g.fitBounds(e),g.setCenter(e.getCenter()),E("onZoomToFitBounds")}catch(e){b("zoomToFitBounds failed")}},T=function(e){var t;if("string"==typeof e){var n=e.split(/,\s*/);t=new google.maps.LatLng(parseFloat(n[0]),parseFloat(n[1]))}else t=e;return t},I=function(e){return null!=e&&""!==e&&0<e.length},D=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);g.setCenter(t)},function(){P(!0)}):P(!1)},P=function(e){b(e?"SimpleGMaps: The Geolocation service failed.":"SimpleGMaps: Your browser doesn't support geolocation.")},E=function(e){void 0!==r[e]&&r[e].call(a)},b=function(e,t,n){n=void 0!==n?n:"log",r.debug&&window.console&&(null!=t&&0<t.length?console[n](e,t):console[n](e))},N=function(e,t){var n=document.querySelector(e);f=new google.maps.places.Autocomplete(n,r.autoCompleteOptions),I(t)?f.addListener("place_changed",function(){document.querySelector(t).click()}):f.addListener("place_changed",q)},q=function(){var e=f.getPlace();e.geometry&&(r.AutoCompleteOptions.moveMap&&g.panTo(e.geometry.location),r.AutoCompleteOptions.setMarker&&new google.maps.Marker({map:g,position:e.geometry.location}),E("onPlaceChanged"))},B=function(e){u.geocode({address:e},function(e,t){t===google.maps.GeocoderStatus.OK?(g.setCenter(e[0].geometry.location),new google.maps.Marker({map:g,position:e[0].geometry.location}),E("onSearchComplete")):(b(t),E("onSearchFail"))})},W=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(n,e[o],o,e);else for(var i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)},R=function(n,o){var i={};return W(n,function(e,t){i[t]=n[t]}),W(o,function(e,t){i[t]=o[t]}),i};return v.init=function(e){var n,t,o,i;r=R(h,e||{}),b(r),a=document.querySelector(r.container),r.MapOptions.center&&(r.MapOptions.center=T(r.MapOptions.center)),r.MapOptions.zoom||(r.MapOptions.zoom=4),a.hasAttribute("data-json")&&(r.jsonsource=a.getAttribute("data-json")),u=new google.maps.Geocoder,p=a.cloneNode(!0),(g=new google.maps.Map(a,r.MapOptions)).addListener("tilesloaded",function(){E("onDrawMap")}),b("init"),!1===r.jsonsource?(b("getMapMarkersFromMarkup"),n=function(e){b("markers done"),w()},t=p.querySelectorAll(".map-marker"),o=Array.prototype.slice.call(t,0),i=t.length,b(t),0===t.length&&n(),o.forEach(function(e){var t={};if(t.title=e.getAttribute("data-title"),e.querySelector(".map-infowindow")?(t.infoWindowContent=e.querySelector("div.map-infowindow").parentElement.innerHTML,t.CustominfoWindowContent=null):e.querySelector(".map-custom-infowindow")&&(t.CustominfoWindowContent=e.querySelector(".map-custom-infowindow").parentElement.innerHTML,t.infoWindowContent=null),e.hasAttribute("data-center")?t.center=!0:t.center=!1,e.hasAttribute("data-icon")?t.iconpath=e.getAttribute("data-icon"):t.iconpath=null,e.hasAttribute("data-icon2x")?t.iconpath2x=e.getAttribute("data-icon2x"):t.iconpath2x=null,e.hasAttribute("data-latlng")?t.latlng=e.getAttribute("data-latlng"):t.latlng=null,e.hasAttribute("data-address")?t.address=e.getAttribute("data-address"):t.address=null,null===t.address&&null===t.latlng)return b("No address or longitude/latitude found in markup. Removing marker."),void i--;M(t,function(e){if(!1===e)return b("fetchPosition response: "+e),void i--;b("fetchPosition response: OK: "+e),t.position=e,A(t.iconpath,t.iconpath2x,function(e){t.icon=e,d.markers.push(t),b(d.markers.length+":"+i),d.markers.length===i&&n()})})})):(b("getMapMarkersFromJSON"),function(o){if(!1!==r.jsonsource){var t=new XMLHttpRequest;t.open("GET",r.jsonsource,!0),t.onload=function(){if(200<=t.status&&t.status<400){var e=S(t.response),n=e.length;e.forEach(function(t){M(t,function(e){if(!1===e)return b("fetchPosition response: "+e),void n--;b("fetchPosition response: OK: "+e),t.position=e,A(t.iconpath,t.iconpath2x,function(e){t.icon=e,d.markers.push(t),b(d.markers.length+":"+n),d.markers.length===n&&o()})})}),E("onJSONLoadSuccess")}else r.debug&&(E("onJSONLoadFail"),console.log("An error occured when trying to load data from "+r.datasource))},t.onerror=function(){r.debug&&(E("onJSONConnectionFail"),console.log("A connection error occured when trying to access "+r.datasource))},t.send()}}(function(e){w()})),E("onInit")},v.Markers={get:function(){return m}},v.Map={get:function(){return g}},v.getMarkerAddress=function(e,t){var n,o;o=function(e){t(e)},b("getMarkerAddress:marker: "+(n=e)),u.geocode({latLng:n.getPosition()},function(e){e&&0<e.length?o(e[0].formatted_address):o(null)})},v.Center=function(){var e=g.getCenter();google.maps.event.trigger(g,"resize"),g.setCenter(e)},v.Search={init:function(e){r.Search=R(h.Search,e||{}),r.Search.AutoComplete&&N(r.Search.input),document.querySelector(r.Search.eventButton).addEventListener("click",function(e){e.preventDefault(),B(document.querySelector(r.Search.input).value)}),document.querySelector(r.Search.input).addEventListener("keypress",function(e){13===e.keyCode&&B(document.querySelector(r.Search.input).value)}),E("onSearchInit")},initAutoComplete:function(e){N(e.input)},search:function(e){B(e)}},v.Directions={TravelModes:{get:function(){return o}},init:function(e){r.Directions=R(h.Directions,e||{}),l.TravelMode=r.Directions.TravelMode,l.UnitSystem=r.Directions.UnitSystem,document.querySelector(r.Directions.eventButton).addEventListener("click",function(e){simplegmaps.Directions.route({origin:document.querySelector(r.Directions.originInput).value,destination:r.Directions.destination})}),r.Directions.AutoComplete&&N(r.Directions.originInput,r.Directions.eventButton),E("onDirectionsInit")},initAutoComplete:function(e){r.AutoComplete=!0,N(e.originInput,e.eventButton)},travelMode:{get:function(){return l.TravelMode},set:function(e){l.TravelMode=e}},unitSystem:{get:function(){return l.UnitSystem},set:function(e){l.UnitSystem=e}},route:function(e){l=R(l,e||{});var t=new google.maps.DirectionsService;b(l),c.setMap(g),r.routeDescriptionContainer&&c.setPanel(document.querySelector(r.routeDescriptionContainer)),t.route(l,function(e,t){})}},v.TrafficLayer={toggle:function(){t&&null!==t.map?t.setMap(null):(t=new google.maps.TrafficLayer).setMap(g)}},v.TransitLayer={toggle:function(){n&&null!==n.map?n.setMap(null):(n=new google.maps.TransitLayer).setMap(g)}},v.BicycleLayer={toggle:function(){e&&null!==e.map?e.setMap(null):(e=new google.maps.BicyclingLayer).setMap(g)}},v.GeoLocation={set:function(){D()}},v.getURL={Android:function(e){return r.AndroidMapLink+"?q="+e},ios:function(e){return r.iOSAppleMapLink+"?q="+e},WindowsPhone:function(e){return r.WP7MapLink+e},Desktop:function(e){return r.DesktopMapLink+"?q="+e},Native:function(e){return-1<navigator.userAgent.toLowerCase().indexOf("android")?this.Android(e):navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)?this.ios(e):navigator.userAgent.match(/Windows Phone/i)?this.WindowsPhone(e):this.Desktop(e)}},v}}();