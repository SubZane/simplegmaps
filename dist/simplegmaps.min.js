/*! simplegmaps - v2.0.0 - 2016-02-02
* https://github.com/SubZane/simplegmaps
* Copyright (c) 2016 Andreas Norman; Licensed MIT */
!function(a,b){"function"==typeof define&&define.amd?define([],b(a)):"object"==typeof exports?module.exports=b(a):a.simplegmaps=b(a)}("undefined"!=typeof global?global:this.window||this.global,function(a){"use strict";var b,c,d,e,f,g,h,i={},j=!!document.querySelector&&!!a.addEventListener,k=!1,l={Driving:google.maps.TravelMode.DRIVING,Bicycling:google.maps.TravelMode.BICYCLING,Transit:google.maps.TravelMode.TRANSIT,Walking:google.maps.TravelMode.WALKING},m={Metric:google.maps.UnitSystem.METRIC,Imperial:google.maps.UnitSystem.IMPERIAL},n={travelMode:l.Driving,unitSystem:m.Metric},o={markers:[]},p=[],q={debug:!0,GeoLocation:!1,ZoomToFitBounds:!1,jsonsource:!1,MapOptions:{draggable:!0,zoom:2,center:"55.604981,13.003822",scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},onDestroy:function(){}},r=function(){h=d.cloneNode(!0),g=new google.maps.Map(d,b.MapOptions),g.addListener("bounds_changed",function(){H("bounds_changed")}),g.addListener("click",function(){H("click")}),g.addListener("dblclick",function(){H("dblclick")}),g.addListener("drag",function(){H("drag")}),g.addListener("dragend",function(){H("dragend")}),g.addListener("dragstart",function(){H("dragstart")}),g.addListener("heading_changed",function(){H("heading_changed")}),g.addListener("idle",function(){H("idle")}),g.addListener("maptypeid_changed",function(){H("maptypeid_changed")}),g.addListener("mousemove",function(){H("mousemove")}),g.addListener("mouseout",function(){H("mouseout")}),g.addListener("mouseover",function(){H("mouseover")}),g.addListener("projection_changed",function(){H("projection_changed")}),g.addListener("resize",function(){H("resize")}),g.addListener("rightclick",function(){H("rightclick")}),g.addListener("tilesloaded",function(){H("tilesloaded")}),g.addListener("tilt_changed",function(){H("tilt_changed")}),g.addListener("zoom_changed",function(){H("zoom_changed")})},s=function(a){if(b.jsonsource===!1)return K("settings.jsonsource === false"),!1;var c=new XMLHttpRequest;c.open("GET",b.jsonsource,!0),c.onload=function(){if(c.status>=200&&c.status<400){var d=t(c.response);J(d,function(b,c){x(b,function(c){b.position=c,y(b.iconpath,b.iconpath2x,function(c){b.icon=c,o.markers.push(b),o.markers.length===d.length&&a()})})})}else b.debug&&console.log("An error occured when trying to load data from "+b.datasource)},c.onerror=function(){b.debug&&console.log("A connection error occured when trying to access "+b.datasource)},c.send()},t=function(a){try{var b=JSON.parse(a);if(b&&"object"==typeof b&&null!==b)return b}catch(c){}return console.warn("Error parsing JSON file"),!1},u=function(a){var b=h.querySelectorAll(".map-marker");J(b,function(c,d){var e={};e.title=c.getAttribute("data-title"),c.querySelector(".map-infowindow")?(e.infoWindowContent=c.querySelector("div.map-infowindow").parentElement.innerHTML,e.CustominfoWindowContent=null):c.querySelector(".map-custom-infowindow")&&(e.CustominfoWindowContent=c.querySelector(".map-custom-infowindow").parentElement.innerHTML,e.infoWindowContent=null),c.hasAttribute("data-center")?e.center=!0:e.center=!1,c.hasAttribute("data-latlng")?e.latlng=c.getAttribute("data-latlng"):e.latlng=null,c.hasAttribute("data-address")?e.address=c.getAttribute("data-address"):e.address=null,c.hasAttribute("data-icon")?e.iconpath=c.getAttribute("data-icon"):e.iconpath=null,c.hasAttribute("data-icon2x")?e.iconpath2x=c.getAttribute("data-icon2x"):e.iconpath2x=null,x(e,function(c){e.position=c,y(e.iconpath,e.iconpath2x,function(c){e.icon=c,o.markers.push(e),o.markers.length===b.length&&a()})})})},v=function(){K("-- placeMarkers --"),J(o.markers,function(a,b){K(a);var c={},d=new google.maps.Marker({title:a.title,center:a.center});p.push(d),d=w(d,a),c.position=a.position,c.icon=a.icon,d.setOptions(c),d.setMap(g),K(d.title),K("lat: "+d.getPosition().lat()),K("lng: "+d.getPosition().lng())}),K("-- map idle --");var a=new google.maps.LatLngBounds;if(p.length>0)if(b.ZoomToFitBounds===!0)K("ZoomToFitBounds"),z();else{K("NO - ZoomToFitBounds");var c=p.filter(function(a){return a.center===!0||"true"===a.center});B(c)?(K("centeredmarker:",c),g.setCenter(c[0].getPosition())):g.setCenter(p[0].getPosition())}else b.MapOptions.center||g.setCenter(a.getCenter());b.GeoLocation&&F(g)},w=function(a,b){if(b.infoWindowContent){var c=new google.maps.InfoWindow({content:b.infoWindowContent});a.addListener("click",function(){c.open(g,a)})}else if(b.CustominfoWindowContent){var e=b.CustominfoWindowContent;google.maps.event.addListener(a,"click",function(){var a=document.querySelector("#simplegmaps-c-iw");null!==a&&a.parentNode.removeChild(a),d.insertAdjacentHTML("afterend",'<div id="simplegmaps-c-iw"></div>'),document.querySelector("#simplegmaps-c-iw").innerHTML=e,document.querySelector("#simplegmaps-c-iw .close").addEventListener("click",function(a){a.preventDefault();var b=document.querySelector("#simplegmaps-c-iw");null!==b&&b.parentNode.removeChild(b)})})}return a},x=function(a,b){if(B(a.latlng))b(A(a.latlng));else if(B(a.address)){var c=new google.maps.Geocoder;c.geocode({address:a.address},function(a,c){c===google.maps.GeocoderStatus.OK&&b(a[0].geometry.location)})}},y=function(a,b,c){var d=new Image;null===a&&null===b||""===a&&""===b?c(null):window.devicePixelRatio>1.5&&null!==typeof b&&""!==b?(d.onload=function(){var a={url:b,size:new google.maps.Size(d.naturalWidth/2,d.naturalHeight/2),scaledSize:new google.maps.Size(d.naturalWidth/2,d.naturalHeight/2),origin:new google.maps.Point(0,0)};c(a)},d.src=b):null!==typeof a&&""!==a?(d.onload=function(){var b={url:a,size:new google.maps.Size(d.naturalWidth,d.naturalHeight)};c(b)},d.src=a):c(null)},z=function(){for(var a=new google.maps.LatLngBounds,b=0;b<p.length;++b)a.extend(p[b].getPosition());if(a.getNorthEast().equals(a.getSouthWest())){var c=new google.maps.LatLng(a.getNorthEast().lat()+.002,a.getNorthEast().lng()+.002),d=new google.maps.LatLng(a.getNorthEast().lat()-.002,a.getNorthEast().lng()-.002);a.extend(c),a.extend(d)}try{g.fitBounds(a),g.setCenter(a.getCenter())}catch(e){}},A=function(a){var b=a.split(/,\s*/),c=new google.maps.LatLng(parseFloat(b[0]),parseFloat(b[1]));return c},B=function(a){return"undefined"!=typeof a&&null!==a&&""!==a&&a.length>0?!0:!1},C=function(){f&&null!==f.map?f.setMap(null):(f=new google.maps.TrafficLayer,f.setMap(g))},D=function(){k&&null!==k.map?k.setMap(null):(k=new google.maps.TransitLayer,k.setMap(g))},E=function(){e&&null!==e.map?e.setMap(null):(e=new google.maps.BicyclingLayer,e.setMap(g))},F=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);g.setCenter(b)},function(){G(!0)}):G(!1)},G=function(a){a?console.console.warn("SimpleGMaps: The Geolocation service failed."):console.console.warn("SimpleGMaps: Your browser doesn't support geolocation.")},H=function(a){void 0!==b[a]&&b[a].call(d)},I=function(a,b){var c={};return J(a,function(b,d){c[d]=a[d]}),J(b,function(a,d){c[d]=b[d]}),c},J=function(a,b,c){if("[object Object]"===Object.prototype.toString.call(a))for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.call(c,a[d],d,a);else for(var e=0,f=a.length;f>e;e++)b.call(c,a[e],e,a)},K=function(a,c,d){d="undefined"!=typeof d?d:"log",b.debug&&window.console&&("undefined"!=typeof c&&null!==c&&c.length>0?console[d](a,c):console[d](a))};return i.destroy=function(){b&&(document.documentElement.classList.remove(b.initClass),document.removeEventListener("click",eventHandler,!1),b=null,c=null,H("onDestroy"))},i.init=function(a){j&&(i.destroy(),b=I(q,a||{}),d=document.querySelector(b.container),b.MapOptions.center&&(b.MapOptions.center=A(b.MapOptions.center)),b.MapOptions.zoom||(b.MapOptions.zoom=4),r(),K(b),K("init"),b.jsonsource===!1?(K("getMapMarkersFromMarkup"),u(function(a){v()})):(K("getMapMarkersFromJSON"),s(function(a){v()})),H("onInit"))},i.Markers={get:function(){return p}},i.Map={get:function(){return g}},i.Directions={travelMode:{get:function(){return n.TravelMode},set:function(a){n.TravelMode=a}},unitSystem:{get:function(){return n.UnitSystem},set:function(a){n.UnitSystem=a}},route:function(a){n=I(n,a||{});var b=new google.maps.DirectionsService,c=new google.maps.DirectionsRenderer({draggable:!0});c.setMap(g),b.route(n,function(a,b){b===google.maps.DirectionsStatus.OK&&c.setDirections(a)})}},i.TrafficLayer={toggle:function(){C()}},i.TransitLayer={toggle:function(){D()}},i.BicycleLayer={toggle:function(){E()}},i.GeoLocation={set:function(){F()}},i});