/*! simplegmaps - v2.0.0 - 2016-02-05
* https://github.com/SubZane/simplegmaps
* Copyright (c) 2016 Andreas Norman; Licensed MIT */
!function(a,b){"function"==typeof define&&define.amd?define([],b(a)):"object"==typeof exports?module.exports=b(a):a.simplegmaps=b(a)}("undefined"!=typeof global?global:this.window||this.global,function(a){"use strict";function b(a){var b=new google.maps.Geocoder;b.geocode({address:a},function(a,b){if(b===google.maps.GeocoderStatus.OK){h.setCenter(a[0].geometry.location);new google.maps.Marker({map:h,position:a[0].geometry.location})}else M(b)})}var c,d,e,f,g,h,i,j,k={},l=!!document.querySelector&&!!a.addEventListener,m=!1,n={Driving:google.maps.TravelMode.DRIVING,Bicycling:google.maps.TravelMode.BICYCLING,Transit:google.maps.TravelMode.TRANSIT,Walking:google.maps.TravelMode.WALKING},o={Metric:google.maps.UnitSystem.METRIC,Imperial:google.maps.UnitSystem.IMPERIAL},p={travelMode:n.Driving,unitSystem:o.Metric},q={markers:[]},r=[],s={debug:!0,GeoLocation:!1,ZoomToFitBounds:!1,jsonsource:!1,AutoComplete:!1,AutoCompleteOptions:{types:["geocode"],componentRestrictions:{country:"se"},moveMap:!1,setMarker:!1},MapOptions:{draggable:!0,zoom:2,center:"55.604981,13.003822",scrollwheel:!1,streetViewControl:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:"DEFAULT"}},onDestroy:function(){}},t=function(){i=e.cloneNode(!0),h=new google.maps.Map(e,c.MapOptions),h.addListener("bounds_changed",function(){J("bounds_changed")}),h.addListener("click",function(){J("click")}),h.addListener("dblclick",function(){J("dblclick")}),h.addListener("drag",function(){J("drag")}),h.addListener("dragend",function(){J("dragend")}),h.addListener("dragstart",function(){J("dragstart")}),h.addListener("heading_changed",function(){J("heading_changed")}),h.addListener("idle",function(){J("idle")}),h.addListener("maptypeid_changed",function(){J("maptypeid_changed")}),h.addListener("mousemove",function(){J("mousemove")}),h.addListener("mouseout",function(){J("mouseout")}),h.addListener("mouseover",function(){J("mouseover")}),h.addListener("projection_changed",function(){J("projection_changed")}),h.addListener("resize",function(){J("resize")}),h.addListener("rightclick",function(){J("rightclick")}),h.addListener("tilesloaded",function(){J("tilesloaded")}),h.addListener("tilt_changed",function(){J("tilt_changed")}),h.addListener("zoom_changed",function(){J("zoom_changed")})},u=function(a){if(c.jsonsource===!1)return M("settings.jsonsource === false"),!1;var b=new XMLHttpRequest;b.open("GET",c.jsonsource,!0),b.onload=function(){if(b.status>=200&&b.status<400){var d=v(b.response);L(d,function(b,c){z(b,function(c){b.position=c,A(b.iconpath,b.iconpath2x,function(c){b.icon=c,q.markers.push(b),q.markers.length===d.length&&a()})})})}else c.debug&&console.log("An error occured when trying to load data from "+c.datasource)},b.onerror=function(){c.debug&&console.log("A connection error occured when trying to access "+c.datasource)},b.send()},v=function(a){try{var b=JSON.parse(a);if(b&&"object"==typeof b&&null!==b)return b}catch(c){}return console.warn("Error parsing JSON file"),!1},w=function(a){var b=i.querySelectorAll(".map-marker");L(b,function(c,d){var e={};e.title=c.getAttribute("data-title"),c.querySelector(".map-infowindow")?(e.infoWindowContent=c.querySelector("div.map-infowindow").parentElement.innerHTML,e.CustominfoWindowContent=null):c.querySelector(".map-custom-infowindow")&&(e.CustominfoWindowContent=c.querySelector(".map-custom-infowindow").parentElement.innerHTML,e.infoWindowContent=null),c.hasAttribute("data-center")?e.center=!0:e.center=!1,c.hasAttribute("data-latlng")?e.latlng=c.getAttribute("data-latlng"):e.latlng=null,c.hasAttribute("data-address")?e.address=c.getAttribute("data-address"):e.address=null,c.hasAttribute("data-icon")?e.iconpath=c.getAttribute("data-icon"):e.iconpath=null,c.hasAttribute("data-icon2x")?e.iconpath2x=c.getAttribute("data-icon2x"):e.iconpath2x=null,z(e,function(c){e.position=c,A(e.iconpath,e.iconpath2x,function(c){e.icon=c,q.markers.push(e),q.markers.length===b.length&&a()})})})},x=function(){M("-- placeMarkers --"),L(q.markers,function(a,b){M(a);var c={},d=new google.maps.Marker({title:a.title,center:a.center});r.push(d),d=y(d,a),c.position=a.position,c.icon=a.icon,d.setOptions(c),d.setMap(h),M(d.title),M("lat: "+d.getPosition().lat()),M("lng: "+d.getPosition().lng())}),M("-- map idle --");var a=new google.maps.LatLngBounds;if(r.length>0)if(c.ZoomToFitBounds===!0)M("ZoomToFitBounds"),B();else{M("NO - ZoomToFitBounds");var b=r.filter(function(a){return a.center===!0||"true"===a.center});D(b)?(M("centeredmarker:",b),h.setCenter(b[0].getPosition())):h.setCenter(r[0].getPosition())}else c.MapOptions.center||h.setCenter(a.getCenter());c.GeoLocation&&H(h)},y=function(a,b){if(b.infoWindowContent){var c=new google.maps.InfoWindow({content:b.infoWindowContent});a.addListener("click",function(){c.open(h,a)})}else if(b.CustominfoWindowContent){var d=b.CustominfoWindowContent;google.maps.event.addListener(a,"click",function(){var a=document.querySelector("#simplegmaps-c-iw");null!==a&&a.parentNode.removeChild(a),e.insertAdjacentHTML("afterend",'<div id="simplegmaps-c-iw"></div>'),document.querySelector("#simplegmaps-c-iw").innerHTML=d,document.querySelector("#simplegmaps-c-iw .close").addEventListener("click",function(a){a.preventDefault();var b=document.querySelector("#simplegmaps-c-iw");null!==b&&b.parentNode.removeChild(b)})})}return a},z=function(a,b){if(D(a.latlng))b(C(a.latlng));else if(D(a.address)){var c=new google.maps.Geocoder;c.geocode({address:a.address},function(a,c){c===google.maps.GeocoderStatus.OK&&b(a[0].geometry.location)})}},A=function(a,b,c){var d=new Image;null===a&&null===b||""===a&&""===b?c(null):window.devicePixelRatio>1.5&&null!==typeof b&&""!==b?(d.onload=function(){var a={url:b,size:new google.maps.Size(d.naturalWidth/2,d.naturalHeight/2),scaledSize:new google.maps.Size(d.naturalWidth/2,d.naturalHeight/2),origin:new google.maps.Point(0,0)};c(a)},d.src=b):null!==typeof a&&""!==a?(d.onload=function(){var b={url:a,size:new google.maps.Size(d.naturalWidth,d.naturalHeight)};c(b)},d.src=a):c(null)},B=function(){for(var a=new google.maps.LatLngBounds,b=0;b<r.length;++b)a.extend(r[b].getPosition());if(a.getNorthEast().equals(a.getSouthWest())){var c=new google.maps.LatLng(a.getNorthEast().lat()+.002,a.getNorthEast().lng()+.002),d=new google.maps.LatLng(a.getNorthEast().lat()-.002,a.getNorthEast().lng()-.002);a.extend(c),a.extend(d)}try{h.fitBounds(a),h.setCenter(a.getCenter())}catch(e){}},C=function(a){var b=a.split(/,\s*/),c=new google.maps.LatLng(parseFloat(b[0]),parseFloat(b[1]));return c},D=function(a){return"undefined"!=typeof a&&null!==a&&""!==a&&a.length>0?!0:!1},E=function(){g&&null!==g.map?g.setMap(null):(g=new google.maps.TrafficLayer,g.setMap(h))},F=function(){m&&null!==m.map?m.setMap(null):(m=new google.maps.TransitLayer,m.setMap(h))},G=function(){f&&null!==f.map?f.setMap(null):(f=new google.maps.BicyclingLayer,f.setMap(h))},H=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);h.setCenter(b)},function(){I(!0)}):I(!1)},I=function(a){a?console.console.warn("SimpleGMaps: The Geolocation service failed."):console.console.warn("SimpleGMaps: Your browser doesn't support geolocation.")},J=function(a){void 0!==c[a]&&c[a].call(e)},K=function(a,b){var c={};return L(a,function(b,d){c[d]=a[d]}),L(b,function(a,d){c[d]=b[d]}),c},L=function(a,b,c){if("[object Object]"===Object.prototype.toString.call(a))for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.call(c,a[d],d,a);else for(var e=0,f=a.length;f>e;e++)b.call(c,a[e],e,a)},M=function(a,b,d){d="undefined"!=typeof d?d:"log",c.debug&&window.console&&("undefined"!=typeof b&&null!==b&&b.length>0?console[d](a,b):console[d](a))},N=function(a,b){var d=document.querySelector(a);j=new google.maps.places.Autocomplete(d,c.autoCompleteOptions),D(b)?j.addListener("place_changed",function(){document.querySelector(b).click()}):j.addListener("place_changed",O)},O=function(){var a=j.getPlace();if(a.geometry&&(c.AutoCompleteOptions.moveMap&&(h.panTo(a.geometry.location),h.setZoom(15)),c.AutoCompleteOptions.setMarker)){new google.maps.Marker({map:h,position:a.geometry.location})}};return k.destroy=function(){c&&(document.documentElement.classList.remove(c.initClass),document.removeEventListener("click",eventHandler,!1),c=null,d=null,J("onDestroy"))},k.init=function(a){l&&(k.destroy(),c=K(s,a||{}),e=document.querySelector(c.container),c.MapOptions.center&&(c.MapOptions.center=C(c.MapOptions.center)),c.MapOptions.zoom||(c.MapOptions.zoom=4),t(),M(c),M("init"),c.jsonsource===!1?(M("getMapMarkersFromMarkup"),w(function(a){x()})):(M("getMapMarkersFromJSON"),u(function(a){x()})),J("onInit"))},k.Markers={get:function(){return r}},k.Map={get:function(){return h}},k.Search={"default":{input:"",eventButton:"",AutoComplete:!1},init:function(a){k.Search.options=K(k.Search["default"],a||{}),k.Search.options.AutoComplete&&N(k.Search.options.input),document.querySelector(k.Search.options.eventButton).addEventListener("click",function(a){a.preventDefault(),b(document.querySelector(k.Search.options.input).value)}),document.querySelector(k.Search.options.input).addEventListener("keypress",function(a){13===a.keyCode&&b(document.querySelector(k.Search.options.input).value)})},initAutoComplete:function(a){N(a.input)},search:function(a){b(a)}},k.Directions={"default":{AutoComplete:!1,TravelMode:p.TravelMode,UnitSystem:p.UnitSystem,originInput:"",destination:"",eventButton:""},init:function(a){k.Directions.options=K(k.Directions["default"],a||{}),p.TravelMode=k.Directions.options.TravelMode,p.UnitSystem=k.Directions.options.UnitSystem,document.querySelector(k.Directions.options.eventButton).addEventListener("click",function(a){k.Directions.route({origin:document.querySelector(k.Directions.options.originInput).value,destination:k.Directions.options.destination})}),k.Directions.options.AutoComplete&&N(k.Directions.options.originInput,k.Directions.options.eventButton)},initAutoComplete:function(a){c.AutoComplete=!0,N(a.originInput,a.eventButton)},travelMode:{get:function(){return p.TravelMode},set:function(a){p.TravelMode=a}},unitSystem:{get:function(){return p.UnitSystem},set:function(a){p.UnitSystem=a}},route:function(a){p=K(p,a||{});var b=new google.maps.DirectionsService,c=new google.maps.DirectionsRenderer({draggable:!0});c.setMap(h),b.route(p,function(a,b){b===google.maps.DirectionsStatus.OK?c.setDirections(a):M(b)})}},k.TrafficLayer={toggle:function(){E()}},k.TransitLayer={toggle:function(){F()}},k.BicycleLayer={toggle:function(){G()}},k.GeoLocation={set:function(){H()}},k});